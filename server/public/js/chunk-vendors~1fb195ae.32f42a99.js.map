{"version":3,"sources":["webpack:///./node_modules/@firebase/storage/dist/index.esm.js","webpack:///./node_modules/@firebase/util/dist/index.esm.js","webpack:///./node_modules/@firebase/logger/dist/index.esm.js","webpack:///./node_modules/@firebase/component/dist/index.esm.js"],"names":["DEFAULT_HOST","CONFIG_STORAGE_BUCKET_KEY","DEFAULT_MAX_OPERATION_RETRY_TIME","DEFAULT_MAX_UPLOAD_RETRY_TIME","FirebaseStorageError","_super","code","message","_this","call","this","prependCode","customData","serverResponse","Object","setPrototypeOf","prototype","codeEquals","defineProperty","get","enumerable","configurable","set","Code","UNKNOWN","OBJECT_NOT_FOUND","BUCKET_NOT_FOUND","PROJECT_NOT_FOUND","QUOTA_EXCEEDED","UNAUTHENTICATED","UNAUTHORIZED","RETRY_LIMIT_EXCEEDED","INVALID_CHECKSUM","CANCELED","INVALID_EVENT_NAME","INVALID_URL","INVALID_DEFAULT_BUCKET","NO_DEFAULT_BUCKET","CANNOT_SLICE_BLOB","SERVER_FILE_WRONG_SIZE","NO_DOWNLOAD_URL","INVALID_ARGUMENT","INVALID_ARGUMENT_COUNT","APP_DELETED","INVALID_ROOT_OPERATION","INVALID_FORMAT","INTERNAL_ERROR","UNSUPPORTED_ENVIRONMENT","unknown","objectNotFound","path","quotaExceeded","bucket","unauthenticated","unauthorized","retryLimitExceeded","canceled","invalidUrl","url","invalidDefaultBucket","noDefaultBucket","cannotSliceBlob","serverFileWrongSize","noDownloadURL","invalidArgument","appDeleted","invalidRootOperation","name","invalidFormat","format","internalError","StringFormat","RAW","BASE64","BASE64URL","DATA_URL","StringData","data","contentType","dataFromString","stringData","utf8Bytes_","base64Bytes_","dataURLBytes_","dataURLContentType_","value","b","i","length","c","charCodeAt","push","valid","hi","lo","Uint8Array","percentEncodedBytes_","decoded","decodeURIComponent","e","hasMinus","indexOf","hasUnder","invalidChar","hasPlus","hasSlash","replace","bytes","atob","array","DataURLParts","dataURL","base64","matches","match","middle","endsWith","substring","rest","dataUrl","parts","s","end","longEnough","ErrorCode","TaskEvent","STATE_CHANGED","InternalTaskState","RUNNING","PAUSING","PAUSED","SUCCESS","CANCELING","ERROR","TaskState","taskStateFromInternalTaskState","state","NetworkXhrIo","sent_","xhr_","XMLHttpRequest","errorCode_","NO_ERROR","sendPromise_","Promise","resolve","addEventListener","ABORT","NETWORK_ERROR","send","method","body","headers","open","undefined","key","hasOwnProperty","setRequestHeader","toString","getErrorCode","getStatus","status","getResponseText","responseText","abort","getResponseHeader","header","addUploadProgressListener","listener","upload","removeUploadProgressListener","removeEventListener","XhrIoPool","createXhrIo","isJustDef","p","isFunction","isNonArrayObject","Array","isArray","isString","String","isNativeBlob","isNativeBlobDefined","Blob","validateNumber","argument","minValue","maxValue","getBlobBuilder","BlobBuilder","WebKitBlobBuilder","getBlob","args","_i","arguments","bb","append","sliceBlob","blob","start","webkitSlice","mozSlice","slice","FbsBlob","elideCopy","size","blobType","data_","type","ArrayBuffer","byteLength","size_","type_","startByte","endByte","realBlob","sliced","buffer","blobby","map","val","apply","uint8Arrays","finalLength_1","forEach","merged_1","index_1","uploadData","Location","path_","fullServerUrl","encode","encodeURIComponent","bucketOnlyServerUrl","makeFromBucketSpec","bucketString","bucketLocation","makeFromUrl","location","bucketDomain","gsModify","loc","charAt","gsPath","gsRegex","RegExp","gsIndices","httpModify","version","firebaseStorageHost","firebaseStoragePath","firebaseStorageRegExp","firebaseStorageIndices","cloudStorageHost","cloudStoragePath","cloudStorageRegExp","cloudStorageIndices","groups","regex","indices","postModify","group","captures","exec","bucketValue","pathValue","jsonObjectOrNull","obj","JSON","parse","parent","index","lastIndexOf","newPath","child","childPath","canonicalChildPath","split","filter","component","join","lastComponent","makeUrl","urlPart","makeQueryString","params","queryPart","nextPart","noXform_","metadata","Mapping","server","local","writable","xform","mappings_","xformPath","fullPath","getMappings","mappings","mappingsXformPath","_metadata","nameMapping","xformSize","Number","sizeMapping","addRef","service","generateRef","makeStorageReference","fromResource","resource","len","mapping","fromResourceString","resourceString","downloadUrlFromResourceString","tokens","tokensList","urls","token","base","queryString","alt","toResourceString","stringify","PREFIXES_KEY","ITEMS_KEY","fromBackendResponse","listResult","prefixes","items","nextPageToken","_a","pathWithoutTrailingSlash","reference","_b","_c","item","fromResponseString","RequestInfo","handler","timeout","urlParams","errorHandler","progressCallback","successCodes","additionalRetryCodes","handlerCheck","cndn","metadataHandler","xhr","text","listHandler","downloadUrlHandler","sharedErrorHandler","err","newErr","objectErrorHandler","shared","getMetadata","maxOperationRetryTime","requestInfo","list","delimiter","pageToken","maxResults","isRoot","getDownloadUrl","updateMetadata","deleteObject","_xhr","_text","determineContentType_","metadataForUpload_","metadataClone","assign","multipartUpload","genBoundary","str","Math","random","boundary","metadata_","metadataString","preBlobPart","postBlobPart","maxUploadRetryTime","ResumableUploadStatus","current","total","finalized","checkResumeHeader_","allowed","allowedStatus","createResumableUpload","metadataForUpload","getResumableUploadStatus","sizeString","isNaN","resumableUploadChunkSize","continueResumableUpload","chunkSize","status_","bytesLeft","bytesToUpload","min","uploadCommand","uploadStatus","newCurrent","Observer","nextOrObserver","error","complete","asFunctions","next","observer","UploadTaskSnapshot","bytesTransferred","totalBytes","task","ref","async","f","argsToForward","then","UploadTask","_transferred","_needToFetchStatus","_needToFetchMetadata","_observers","_error","_uploadUrl","_request","_chunkMultiplier","_resolve","_reject","_ref","_blob","_mappings","_resumable","_shouldDoResumable","_state","_errorHandler","completeTransitions_","_transition","_metadataErrorHandler","_promise","reject","_start","_makeProgressCallback","sizeBefore","loaded","_updateProgress","_createResumable","_fetchStatus","_fetchMetadata","_continueUpload","_oneShotUpload","_resolveToken","callback","storage","getAuthToken","authToken","_location","createRequest","makeRequest","getPromise","statusRequest","uploadRequest","newStatus","_increaseMultiplier","currentSize","metadataRequest","multipartRequest","transferred","old","_notifyObservers","cancel","wasPaused","externalState","on","completed","_addObserver","_removeObserver","onFulfilled","onRejected","catch","_notifyObserver","splice","_finishPromise","observers","triggered","bind","snapshot","toCall","resume","pause","Reference","_service","newRef","_throwIfRoot","uploadBytesResumable","uploadString","listAll","accumulator","listAllHelper","opt","nextPage","label","list$1","sent","options","op","getMetadata$1","updateMetadata$1","getDownloadURL","deleteObject$1","getChild","UploadTaskSnapshotCompat","_delegate","UploadTaskCompat","_snapshot","wrappedNextOrObserver","taskSnapshot","ListResultCompat","ReferenceCompat","root","put","putString","r","delete","FailRequest","promise_","_appDelete","waitSeconds","timeoutId","hitTimeout","cancelState","triggeredCallback","triggerCallback","callWithDelay","millis","setTimeout","success","waitMillis","mustStop","stopped","stop","wasTimeout","clearTimeout","id","NetworkRequest","errorCallback","pool","pendingXhr_","backoffId_","canceled_","appDelete_","url_","method_","headers_","body_","successCodes_","additionalRetryCodes_","callback_","errorCallback_","progressCallback_","timeout_","pool_","resolve_","reject_","start_","self","doTheRequest","backoffCallback","RequestEndStatus","progressListener","hitServer","isRetryStatusCode_","successCode","wasCanceled","progressEvent","lengthComputable","backoffDone","requestWentThrough","wasSuccessCode","result","appDelete","isFiveHundredCode","extraRetryCodes","isExtraRetryCode","isRequestSpecificRetryCode","addAuthHeader_","addVersionHeader_","SDK_VERSION","addGmpidHeader_","appId","isUrl","test","refFromURL","refFromPath","StorageService","_bucket","includes","serviceOrRef","pathOrUrl","extractBucket","config","app","_authProvider","_pool","_url","_appId","_deleted","_maxOperationRetryTime","_maxUploadRetryTime","_requests","Set","time","POSITIVE_INFINITY","auth","tokenData","getImmediate","optional","getToken","accessToken","_delete","request","clear","request_1","add","StorageServiceCompat","INTERNAL","setMaxUploadRetryTime","setMaxOperationRetryTime","STORAGE_TYPE","factory","container","getProvider","authProvider","storageServiceCompat","registerStorage","instance","namespaceExports","Storage","registerComponent","setServiceProps","setMultipleInstances","registerVersion","stringToByteArray","out","byteArrayToString","pos","c1","fromCharCode","c2","c3","c4","u","deepCopy","deepExtend","target","source","constructor","Date","dateValue","getTime","prop","isValidKey","Deferred","promise","wrapCallback","isNode","global","process","isBrowser","ERROR_NAME","FirebaseError","Error","captureStackTrace","ErrorFactory","create","serviceName","errors","fullCode","template","replaceTemplate","fullMessage","PATTERN","_","contains","Sha1","chain_","buf_","W_","pad_","inbuf_","total_","blockSize","reset","compress_","buf","offset","W","t","k","a","d","update","lengthMinusBlock","n","inbuf","digest","totalBits","j","createSubscribe","executor","onNoObservers","proxy","ObserverProxy","subscribe","unsubscribes","observerCount","forEachObserver","close","implementsAnyMethods","noop","unsub","unsubscribeOne","finalError","fn","sendOne","console","methods","methods_1","__spreadArrays","il","jl","LogLevel","instances","levelStringToEnum","DEBUG","VERBOSE","INFO","WARN","SILENT","defaultLogLevel","ConsoleMethod","defaultLogHandler","logType","logLevel","now","toISOString","Logger","_logLevel","_logHandler","_userLogHandler","TypeError","setLogLevel","debug","log","info","warn","level","inst","setUserLogHandler","logCallback","_loop_1","customLogLevel","userLogHandler","arg","ignored","toLowerCase","instances_1","Component","instanceFactory","multipleInstances","serviceProps","instantiationMode","setInstantiationMode","mode","props","DEFAULT_ENTRY_NAME","Provider","Map","instancesDeferred","identifier","normalizedIdentifier","normalizeInstanceIdentifier","has","deferred","getOrInitializeService","getComponent","setComponent","e_1","isComponentEager","entries","done","_d","instanceIdentifier","instanceDeferred","e_1_1","return","clearInstance","services","from","values","all","isComponentSet","normalizeIdentifierForFactory","ComponentContainer","providers","addComponent","provider","addOrOverwriteComponent","getProviders"],"mappings":"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","file":"js/chunk-vendors~1fb195ae.32f42a99.js","sourcesContent":["import firebase from '@firebase/app';\nimport { __extends, __awaiter, __generator, __assign, __spreadArrays } from 'tslib';\nimport { FirebaseError } from '@firebase/util';\nimport { Component } from '@firebase/component';\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Constants used in the Firebase Storage library.\r\n */\r\n/**\r\n * Domain name for firebase storage.\r\n */\r\nvar DEFAULT_HOST = 'firebasestorage.googleapis.com';\r\n/**\r\n * The key in Firebase config json for the storage bucket.\r\n */\r\nvar CONFIG_STORAGE_BUCKET_KEY = 'storageBucket';\r\n/**\r\n * 2 minutes\r\n *\r\n * The timeout for all operations except upload.\r\n */\r\nvar DEFAULT_MAX_OPERATION_RETRY_TIME = 2 * 60 * 1000;\r\n/**\r\n * 10 minutes\r\n *\r\n * The timeout for upload.\r\n */\r\nvar DEFAULT_MAX_UPLOAD_RETRY_TIME = 10 * 60 * 1000;\n\nvar FirebaseStorageError = /** @class */ (function (_super) {\r\n    __extends(FirebaseStorageError, _super);\r\n    function FirebaseStorageError(code, message) {\r\n        var _this = _super.call(this, prependCode(code), \"Firebase Storage: \" + message + \" (\" + prependCode(code) + \")\") || this;\r\n        _this.customData = { serverResponse: null };\r\n        // Without this, `instanceof FirebaseStorageError`, in tests for example,\r\n        // returns false.\r\n        Object.setPrototypeOf(_this, FirebaseStorageError.prototype);\r\n        return _this;\r\n    }\r\n    FirebaseStorageError.prototype.codeEquals = function (code) {\r\n        return prependCode(code) === this.code;\r\n    };\r\n    Object.defineProperty(FirebaseStorageError.prototype, \"message\", {\r\n        get: function () {\r\n            if (this.customData.serverResponse) {\r\n                return this.message + \"\\n\" + this.customData.serverResponse;\r\n            }\r\n            else {\r\n                return this.message;\r\n            }\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FirebaseStorageError.prototype, \"serverResponse\", {\r\n        get: function () {\r\n            return this.customData.serverResponse;\r\n        },\r\n        set: function (serverResponse) {\r\n            this.customData.serverResponse = serverResponse;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return FirebaseStorageError;\r\n}(FirebaseError));\r\nvar Code = {\r\n    // Shared between all platforms\r\n    UNKNOWN: 'unknown',\r\n    OBJECT_NOT_FOUND: 'object-not-found',\r\n    BUCKET_NOT_FOUND: 'bucket-not-found',\r\n    PROJECT_NOT_FOUND: 'project-not-found',\r\n    QUOTA_EXCEEDED: 'quota-exceeded',\r\n    UNAUTHENTICATED: 'unauthenticated',\r\n    UNAUTHORIZED: 'unauthorized',\r\n    RETRY_LIMIT_EXCEEDED: 'retry-limit-exceeded',\r\n    INVALID_CHECKSUM: 'invalid-checksum',\r\n    CANCELED: 'canceled',\r\n    // JS specific\r\n    INVALID_EVENT_NAME: 'invalid-event-name',\r\n    INVALID_URL: 'invalid-url',\r\n    INVALID_DEFAULT_BUCKET: 'invalid-default-bucket',\r\n    NO_DEFAULT_BUCKET: 'no-default-bucket',\r\n    CANNOT_SLICE_BLOB: 'cannot-slice-blob',\r\n    SERVER_FILE_WRONG_SIZE: 'server-file-wrong-size',\r\n    NO_DOWNLOAD_URL: 'no-download-url',\r\n    INVALID_ARGUMENT: 'invalid-argument',\r\n    INVALID_ARGUMENT_COUNT: 'invalid-argument-count',\r\n    APP_DELETED: 'app-deleted',\r\n    INVALID_ROOT_OPERATION: 'invalid-root-operation',\r\n    INVALID_FORMAT: 'invalid-format',\r\n    INTERNAL_ERROR: 'internal-error',\r\n    UNSUPPORTED_ENVIRONMENT: 'unsupported-environment'\r\n};\r\nfunction prependCode(code) {\r\n    return 'storage/' + code;\r\n}\r\nfunction unknown() {\r\n    var message = 'An unknown error occurred, please check the error payload for ' +\r\n        'server response.';\r\n    return new FirebaseStorageError(Code.UNKNOWN, message);\r\n}\r\nfunction objectNotFound(path) {\r\n    return new FirebaseStorageError(Code.OBJECT_NOT_FOUND, \"Object '\" + path + \"' does not exist.\");\r\n}\r\nfunction quotaExceeded(bucket) {\r\n    return new FirebaseStorageError(Code.QUOTA_EXCEEDED, \"Quota for bucket '\" +\r\n        bucket +\r\n        \"' exceeded, please view quota on \" +\r\n        'https://firebase.google.com/pricing/.');\r\n}\r\nfunction unauthenticated() {\r\n    var message = 'User is not authenticated, please authenticate using Firebase ' +\r\n        'Authentication and try again.';\r\n    return new FirebaseStorageError(Code.UNAUTHENTICATED, message);\r\n}\r\nfunction unauthorized(path) {\r\n    return new FirebaseStorageError(Code.UNAUTHORIZED, \"User does not have permission to access '\" + path + \"'.\");\r\n}\r\nfunction retryLimitExceeded() {\r\n    return new FirebaseStorageError(Code.RETRY_LIMIT_EXCEEDED, 'Max retry time for operation exceeded, please try again.');\r\n}\r\nfunction canceled() {\r\n    return new FirebaseStorageError(Code.CANCELED, 'User canceled the upload/download.');\r\n}\r\nfunction invalidUrl(url) {\r\n    return new FirebaseStorageError(Code.INVALID_URL, \"Invalid URL '\" + url + \"'.\");\r\n}\r\nfunction invalidDefaultBucket(bucket) {\r\n    return new FirebaseStorageError(Code.INVALID_DEFAULT_BUCKET, \"Invalid default bucket '\" + bucket + \"'.\");\r\n}\r\nfunction noDefaultBucket() {\r\n    return new FirebaseStorageError(Code.NO_DEFAULT_BUCKET, 'No default bucket ' +\r\n        \"found. Did you set the '\" +\r\n        CONFIG_STORAGE_BUCKET_KEY +\r\n        \"' property when initializing the app?\");\r\n}\r\nfunction cannotSliceBlob() {\r\n    return new FirebaseStorageError(Code.CANNOT_SLICE_BLOB, 'Cannot slice blob for upload. Please retry the upload.');\r\n}\r\nfunction serverFileWrongSize() {\r\n    return new FirebaseStorageError(Code.SERVER_FILE_WRONG_SIZE, 'Server recorded incorrect upload file size, please retry the upload.');\r\n}\r\nfunction noDownloadURL() {\r\n    return new FirebaseStorageError(Code.NO_DOWNLOAD_URL, 'The given file does not have any download URLs.');\r\n}\r\nfunction invalidArgument(message) {\r\n    return new FirebaseStorageError(Code.INVALID_ARGUMENT, message);\r\n}\r\nfunction appDeleted() {\r\n    return new FirebaseStorageError(Code.APP_DELETED, 'The Firebase app was deleted.');\r\n}\r\n/**\r\n * @param name - The name of the operation that was invalid.\r\n */\r\nfunction invalidRootOperation(name) {\r\n    return new FirebaseStorageError(Code.INVALID_ROOT_OPERATION, \"The operation '\" +\r\n        name +\r\n        \"' cannot be performed on a root reference, create a non-root \" +\r\n        \"reference using child, such as .child('file.png').\");\r\n}\r\n/**\r\n * @param format - The format that was not valid.\r\n * @param message - A message describing the format violation.\r\n */\r\nfunction invalidFormat(format, message) {\r\n    return new FirebaseStorageError(Code.INVALID_FORMAT, \"String does not match format '\" + format + \"': \" + message);\r\n}\r\n/**\r\n * @param message - A message describing the internal error.\r\n */\r\nfunction internalError(message) {\r\n    throw new FirebaseStorageError(Code.INTERNAL_ERROR, 'Internal error: ' + message);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar StringFormat = {\r\n    RAW: 'raw',\r\n    BASE64: 'base64',\r\n    BASE64URL: 'base64url',\r\n    DATA_URL: 'data_url'\r\n};\r\nvar StringData = /** @class */ (function () {\r\n    function StringData(data, contentType) {\r\n        this.data = data;\r\n        this.contentType = contentType || null;\r\n    }\r\n    return StringData;\r\n}());\r\nfunction dataFromString(format, stringData) {\r\n    switch (format) {\r\n        case StringFormat.RAW:\r\n            return new StringData(utf8Bytes_(stringData));\r\n        case StringFormat.BASE64:\r\n        case StringFormat.BASE64URL:\r\n            return new StringData(base64Bytes_(format, stringData));\r\n        case StringFormat.DATA_URL:\r\n            return new StringData(dataURLBytes_(stringData), dataURLContentType_(stringData));\r\n        // do nothing\r\n    }\r\n    // assert(false);\r\n    throw unknown();\r\n}\r\nfunction utf8Bytes_(value) {\r\n    var b = [];\r\n    for (var i = 0; i < value.length; i++) {\r\n        var c = value.charCodeAt(i);\r\n        if (c <= 127) {\r\n            b.push(c);\r\n        }\r\n        else {\r\n            if (c <= 2047) {\r\n                b.push(192 | (c >> 6), 128 | (c & 63));\r\n            }\r\n            else {\r\n                if ((c & 64512) === 55296) {\r\n                    // The start of a surrogate pair.\r\n                    var valid = i < value.length - 1 && (value.charCodeAt(i + 1) & 64512) === 56320;\r\n                    if (!valid) {\r\n                        // The second surrogate wasn't there.\r\n                        b.push(239, 191, 189);\r\n                    }\r\n                    else {\r\n                        var hi = c;\r\n                        var lo = value.charCodeAt(++i);\r\n                        c = 65536 | ((hi & 1023) << 10) | (lo & 1023);\r\n                        b.push(240 | (c >> 18), 128 | ((c >> 12) & 63), 128 | ((c >> 6) & 63), 128 | (c & 63));\r\n                    }\r\n                }\r\n                else {\r\n                    if ((c & 64512) === 56320) {\r\n                        // Invalid low surrogate.\r\n                        b.push(239, 191, 189);\r\n                    }\r\n                    else {\r\n                        b.push(224 | (c >> 12), 128 | ((c >> 6) & 63), 128 | (c & 63));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return new Uint8Array(b);\r\n}\r\nfunction percentEncodedBytes_(value) {\r\n    var decoded;\r\n    try {\r\n        decoded = decodeURIComponent(value);\r\n    }\r\n    catch (e) {\r\n        throw invalidFormat(StringFormat.DATA_URL, 'Malformed data URL.');\r\n    }\r\n    return utf8Bytes_(decoded);\r\n}\r\nfunction base64Bytes_(format, value) {\r\n    switch (format) {\r\n        case StringFormat.BASE64: {\r\n            var hasMinus = value.indexOf('-') !== -1;\r\n            var hasUnder = value.indexOf('_') !== -1;\r\n            if (hasMinus || hasUnder) {\r\n                var invalidChar = hasMinus ? '-' : '_';\r\n                throw invalidFormat(format, \"Invalid character '\" +\r\n                    invalidChar +\r\n                    \"' found: is it base64url encoded?\");\r\n            }\r\n            break;\r\n        }\r\n        case StringFormat.BASE64URL: {\r\n            var hasPlus = value.indexOf('+') !== -1;\r\n            var hasSlash = value.indexOf('/') !== -1;\r\n            if (hasPlus || hasSlash) {\r\n                var invalidChar = hasPlus ? '+' : '/';\r\n                throw invalidFormat(format, \"Invalid character '\" + invalidChar + \"' found: is it base64 encoded?\");\r\n            }\r\n            value = value.replace(/-/g, '+').replace(/_/g, '/');\r\n            break;\r\n        }\r\n        // do nothing\r\n    }\r\n    var bytes;\r\n    try {\r\n        bytes = atob(value);\r\n    }\r\n    catch (e) {\r\n        throw invalidFormat(format, 'Invalid character found');\r\n    }\r\n    var array = new Uint8Array(bytes.length);\r\n    for (var i = 0; i < bytes.length; i++) {\r\n        array[i] = bytes.charCodeAt(i);\r\n    }\r\n    return array;\r\n}\r\nvar DataURLParts = /** @class */ (function () {\r\n    function DataURLParts(dataURL) {\r\n        this.base64 = false;\r\n        this.contentType = null;\r\n        var matches = dataURL.match(/^data:([^,]+)?,/);\r\n        if (matches === null) {\r\n            throw invalidFormat(StringFormat.DATA_URL, \"Must be formatted 'data:[<mediatype>][;base64],<data>\");\r\n        }\r\n        var middle = matches[1] || null;\r\n        if (middle != null) {\r\n            this.base64 = endsWith(middle, ';base64');\r\n            this.contentType = this.base64\r\n                ? middle.substring(0, middle.length - ';base64'.length)\r\n                : middle;\r\n        }\r\n        this.rest = dataURL.substring(dataURL.indexOf(',') + 1);\r\n    }\r\n    return DataURLParts;\r\n}());\r\nfunction dataURLBytes_(dataUrl) {\r\n    var parts = new DataURLParts(dataUrl);\r\n    if (parts.base64) {\r\n        return base64Bytes_(StringFormat.BASE64, parts.rest);\r\n    }\r\n    else {\r\n        return percentEncodedBytes_(parts.rest);\r\n    }\r\n}\r\nfunction dataURLContentType_(dataUrl) {\r\n    var parts = new DataURLParts(dataUrl);\r\n    return parts.contentType;\r\n}\r\nfunction endsWith(s, end) {\r\n    var longEnough = s.length >= end.length;\r\n    if (!longEnough) {\r\n        return false;\r\n    }\r\n    return s.substring(s.length - end.length) === end;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar TaskEvent = {\r\n    /** Triggered whenever the task changes or progress is updated. */\r\n    STATE_CHANGED: 'state_changed'\r\n};\r\nvar InternalTaskState = {\r\n    RUNNING: 'running',\r\n    PAUSING: 'pausing',\r\n    PAUSED: 'paused',\r\n    SUCCESS: 'success',\r\n    CANCELING: 'canceling',\r\n    CANCELED: 'canceled',\r\n    ERROR: 'error'\r\n};\r\nvar TaskState = {\r\n    /** The task is currently transferring data. */\r\n    RUNNING: 'running',\r\n    /** The task was paused by the user. */\r\n    PAUSED: 'paused',\r\n    /** The task completed successfully. */\r\n    SUCCESS: 'success',\r\n    /** The task was canceled. */\r\n    CANCELED: 'canceled',\r\n    /** The task failed with an error. */\r\n    ERROR: 'error'\r\n};\r\nfunction taskStateFromInternalTaskState(state) {\r\n    switch (state) {\r\n        case InternalTaskState.RUNNING:\r\n        case InternalTaskState.PAUSING:\r\n        case InternalTaskState.CANCELING:\r\n            return TaskState.RUNNING;\r\n        case InternalTaskState.PAUSED:\r\n            return TaskState.PAUSED;\r\n        case InternalTaskState.SUCCESS:\r\n            return TaskState.SUCCESS;\r\n        case InternalTaskState.CANCELED:\r\n            return TaskState.CANCELED;\r\n        case InternalTaskState.ERROR:\r\n            return TaskState.ERROR;\r\n        default:\r\n            // TODO(andysoto): assert(false);\r\n            return TaskState.ERROR;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar ErrorCode;\r\n(function (ErrorCode) {\r\n    ErrorCode[ErrorCode[\"NO_ERROR\"] = 0] = \"NO_ERROR\";\r\n    ErrorCode[ErrorCode[\"NETWORK_ERROR\"] = 1] = \"NETWORK_ERROR\";\r\n    ErrorCode[ErrorCode[\"ABORT\"] = 2] = \"ABORT\";\r\n})(ErrorCode || (ErrorCode = {}));\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * We use this instead of goog.net.XhrIo because goog.net.XhrIo is hyuuuuge and\r\n * doesn't work in React Native on Android.\r\n */\r\nvar NetworkXhrIo = /** @class */ (function () {\r\n    function NetworkXhrIo() {\r\n        var _this = this;\r\n        this.sent_ = false;\r\n        this.xhr_ = new XMLHttpRequest();\r\n        this.errorCode_ = ErrorCode.NO_ERROR;\r\n        this.sendPromise_ = new Promise(function (resolve) {\r\n            _this.xhr_.addEventListener('abort', function () {\r\n                _this.errorCode_ = ErrorCode.ABORT;\r\n                resolve(_this);\r\n            });\r\n            _this.xhr_.addEventListener('error', function () {\r\n                _this.errorCode_ = ErrorCode.NETWORK_ERROR;\r\n                resolve(_this);\r\n            });\r\n            _this.xhr_.addEventListener('load', function () {\r\n                resolve(_this);\r\n            });\r\n        });\r\n    }\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.send = function (url, method, body, headers) {\r\n        if (this.sent_) {\r\n            throw internalError('cannot .send() more than once');\r\n        }\r\n        this.sent_ = true;\r\n        this.xhr_.open(method, url, true);\r\n        if (headers !== undefined) {\r\n            for (var key in headers) {\r\n                if (headers.hasOwnProperty(key)) {\r\n                    this.xhr_.setRequestHeader(key, headers[key].toString());\r\n                }\r\n            }\r\n        }\r\n        if (body !== undefined) {\r\n            this.xhr_.send(body);\r\n        }\r\n        else {\r\n            this.xhr_.send();\r\n        }\r\n        return this.sendPromise_;\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getErrorCode = function () {\r\n        if (!this.sent_) {\r\n            throw internalError('cannot .getErrorCode() before sending');\r\n        }\r\n        return this.errorCode_;\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getStatus = function () {\r\n        if (!this.sent_) {\r\n            throw internalError('cannot .getStatus() before sending');\r\n        }\r\n        try {\r\n            return this.xhr_.status;\r\n        }\r\n        catch (e) {\r\n            return -1;\r\n        }\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getResponseText = function () {\r\n        if (!this.sent_) {\r\n            throw internalError('cannot .getResponseText() before sending');\r\n        }\r\n        return this.xhr_.responseText;\r\n    };\r\n    /**\r\n     * Aborts the request.\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.abort = function () {\r\n        this.xhr_.abort();\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getResponseHeader = function (header) {\r\n        return this.xhr_.getResponseHeader(header);\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.addUploadProgressListener = function (listener) {\r\n        if (this.xhr_.upload != null) {\r\n            this.xhr_.upload.addEventListener('progress', listener);\r\n        }\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.removeUploadProgressListener = function (listener) {\r\n        if (this.xhr_.upload != null) {\r\n            this.xhr_.upload.removeEventListener('progress', listener);\r\n        }\r\n    };\r\n    return NetworkXhrIo;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Factory-like class for creating XhrIo instances.\r\n */\r\nvar XhrIoPool = /** @class */ (function () {\r\n    function XhrIoPool() {\r\n    }\r\n    XhrIoPool.prototype.createXhrIo = function () {\r\n        return new NetworkXhrIo();\r\n    };\r\n    return XhrIoPool;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction isJustDef(p) {\r\n    return p !== void 0;\r\n}\r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\nfunction isFunction(p) {\r\n    return typeof p === 'function';\r\n}\r\nfunction isNonArrayObject(p) {\r\n    return typeof p === 'object' && !Array.isArray(p);\r\n}\r\nfunction isString(p) {\r\n    return typeof p === 'string' || p instanceof String;\r\n}\r\nfunction isNativeBlob(p) {\r\n    return isNativeBlobDefined() && p instanceof Blob;\r\n}\r\nfunction isNativeBlobDefined() {\r\n    return typeof Blob !== 'undefined';\r\n}\r\nfunction validateNumber(argument, minValue, maxValue, value) {\r\n    if (value < minValue) {\r\n        throw new FirebaseStorageError(Code.INVALID_ARGUMENT, \"Invalid value for '\" + argument + \"'. Expected \" + minValue + \" or greater.\");\r\n    }\r\n    if (value > maxValue) {\r\n        throw new FirebaseStorageError(Code.INVALID_ARGUMENT, \"Invalid value for '\" + argument + \"'. Expected \" + maxValue + \" or less.\");\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getBlobBuilder() {\r\n    if (typeof BlobBuilder !== 'undefined') {\r\n        return BlobBuilder;\r\n    }\r\n    else if (typeof WebKitBlobBuilder !== 'undefined') {\r\n        return WebKitBlobBuilder;\r\n    }\r\n    else {\r\n        return undefined;\r\n    }\r\n}\r\n/**\r\n * Concatenates one or more values together and converts them to a Blob.\r\n *\r\n * @param args The values that will make up the resulting blob.\r\n * @return The blob.\r\n */\r\nfunction getBlob() {\r\n    var args = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        args[_i] = arguments[_i];\r\n    }\r\n    var BlobBuilder = getBlobBuilder();\r\n    if (BlobBuilder !== undefined) {\r\n        var bb = new BlobBuilder();\r\n        for (var i = 0; i < args.length; i++) {\r\n            bb.append(args[i]);\r\n        }\r\n        return bb.getBlob();\r\n    }\r\n    else {\r\n        if (isNativeBlobDefined()) {\r\n            return new Blob(args);\r\n        }\r\n        else {\r\n            throw new FirebaseStorageError(Code.UNSUPPORTED_ENVIRONMENT, \"This browser doesn't seem to support creating Blobs\");\r\n        }\r\n    }\r\n}\r\n/**\r\n * Slices the blob. The returned blob contains data from the start byte\r\n * (inclusive) till the end byte (exclusive). Negative indices cannot be used.\r\n *\r\n * @param blob The blob to be sliced.\r\n * @param start Index of the starting byte.\r\n * @param end Index of the ending byte.\r\n * @return The blob slice or null if not supported.\r\n */\r\nfunction sliceBlob(blob, start, end) {\r\n    if (blob.webkitSlice) {\r\n        return blob.webkitSlice(start, end);\r\n    }\r\n    else if (blob.mozSlice) {\r\n        return blob.mozSlice(start, end);\r\n    }\r\n    else if (blob.slice) {\r\n        return blob.slice(start, end);\r\n    }\r\n    return null;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param opt_elideCopy - If true, doesn't copy mutable input data\r\n *     (e.g. Uint8Arrays). Pass true only if you know the objects will not be\r\n *     modified after this blob's construction.\r\n */\r\nvar FbsBlob = /** @class */ (function () {\r\n    function FbsBlob(data, elideCopy) {\r\n        var size = 0;\r\n        var blobType = '';\r\n        if (isNativeBlob(data)) {\r\n            this.data_ = data;\r\n            size = data.size;\r\n            blobType = data.type;\r\n        }\r\n        else if (data instanceof ArrayBuffer) {\r\n            if (elideCopy) {\r\n                this.data_ = new Uint8Array(data);\r\n            }\r\n            else {\r\n                this.data_ = new Uint8Array(data.byteLength);\r\n                this.data_.set(new Uint8Array(data));\r\n            }\r\n            size = this.data_.length;\r\n        }\r\n        else if (data instanceof Uint8Array) {\r\n            if (elideCopy) {\r\n                this.data_ = data;\r\n            }\r\n            else {\r\n                this.data_ = new Uint8Array(data.length);\r\n                this.data_.set(data);\r\n            }\r\n            size = data.length;\r\n        }\r\n        this.size_ = size;\r\n        this.type_ = blobType;\r\n    }\r\n    FbsBlob.prototype.size = function () {\r\n        return this.size_;\r\n    };\r\n    FbsBlob.prototype.type = function () {\r\n        return this.type_;\r\n    };\r\n    FbsBlob.prototype.slice = function (startByte, endByte) {\r\n        if (isNativeBlob(this.data_)) {\r\n            var realBlob = this.data_;\r\n            var sliced = sliceBlob(realBlob, startByte, endByte);\r\n            if (sliced === null) {\r\n                return null;\r\n            }\r\n            return new FbsBlob(sliced);\r\n        }\r\n        else {\r\n            var slice = new Uint8Array(this.data_.buffer, startByte, endByte - startByte);\r\n            return new FbsBlob(slice, true);\r\n        }\r\n    };\r\n    FbsBlob.getBlob = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        if (isNativeBlobDefined()) {\r\n            var blobby = args.map(function (val) {\r\n                if (val instanceof FbsBlob) {\r\n                    return val.data_;\r\n                }\r\n                else {\r\n                    return val;\r\n                }\r\n            });\r\n            return new FbsBlob(getBlob.apply(null, blobby));\r\n        }\r\n        else {\r\n            var uint8Arrays = args.map(function (val) {\r\n                if (isString(val)) {\r\n                    return dataFromString(StringFormat.RAW, val).data;\r\n                }\r\n                else {\r\n                    // Blobs don't exist, so this has to be a Uint8Array.\r\n                    return val.data_;\r\n                }\r\n            });\r\n            var finalLength_1 = 0;\r\n            uint8Arrays.forEach(function (array) {\r\n                finalLength_1 += array.byteLength;\r\n            });\r\n            var merged_1 = new Uint8Array(finalLength_1);\r\n            var index_1 = 0;\r\n            uint8Arrays.forEach(function (array) {\r\n                for (var i = 0; i < array.length; i++) {\r\n                    merged_1[index_1++] = array[i];\r\n                }\r\n            });\r\n            return new FbsBlob(merged_1, true);\r\n        }\r\n    };\r\n    FbsBlob.prototype.uploadData = function () {\r\n        return this.data_;\r\n    };\r\n    return FbsBlob;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar Location = /** @class */ (function () {\r\n    function Location(bucket, path) {\r\n        this.bucket = bucket;\r\n        this.path_ = path;\r\n    }\r\n    Object.defineProperty(Location.prototype, \"path\", {\r\n        get: function () {\r\n            return this.path_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Location.prototype, \"isRoot\", {\r\n        get: function () {\r\n            return this.path.length === 0;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Location.prototype.fullServerUrl = function () {\r\n        var encode = encodeURIComponent;\r\n        return '/b/' + encode(this.bucket) + '/o/' + encode(this.path);\r\n    };\r\n    Location.prototype.bucketOnlyServerUrl = function () {\r\n        var encode = encodeURIComponent;\r\n        return '/b/' + encode(this.bucket) + '/o';\r\n    };\r\n    Location.makeFromBucketSpec = function (bucketString) {\r\n        var bucketLocation;\r\n        try {\r\n            bucketLocation = Location.makeFromUrl(bucketString);\r\n        }\r\n        catch (e) {\r\n            // Not valid URL, use as-is. This lets you put bare bucket names in\r\n            // config.\r\n            return new Location(bucketString, '');\r\n        }\r\n        if (bucketLocation.path === '') {\r\n            return bucketLocation;\r\n        }\r\n        else {\r\n            throw invalidDefaultBucket(bucketString);\r\n        }\r\n    };\r\n    Location.makeFromUrl = function (url) {\r\n        var location = null;\r\n        var bucketDomain = '([A-Za-z0-9.\\\\-_]+)';\r\n        function gsModify(loc) {\r\n            if (loc.path.charAt(loc.path.length - 1) === '/') {\r\n                loc.path_ = loc.path_.slice(0, -1);\r\n            }\r\n        }\r\n        var gsPath = '(/(.*))?$';\r\n        var gsRegex = new RegExp('^gs://' + bucketDomain + gsPath, 'i');\r\n        var gsIndices = { bucket: 1, path: 3 };\r\n        function httpModify(loc) {\r\n            loc.path_ = decodeURIComponent(loc.path);\r\n        }\r\n        var version = 'v[A-Za-z0-9_]+';\r\n        var firebaseStorageHost = DEFAULT_HOST.replace(/[.]/g, '\\\\.');\r\n        var firebaseStoragePath = '(/([^?#]*).*)?$';\r\n        var firebaseStorageRegExp = new RegExp(\"^https?://\" + firebaseStorageHost + \"/\" + version + \"/b/\" + bucketDomain + \"/o\" + firebaseStoragePath, 'i');\r\n        var firebaseStorageIndices = { bucket: 1, path: 3 };\r\n        var cloudStorageHost = '(?:storage.googleapis.com|storage.cloud.google.com)';\r\n        var cloudStoragePath = '([^?#]*)';\r\n        var cloudStorageRegExp = new RegExp(\"^https?://\" + cloudStorageHost + \"/\" + bucketDomain + \"/\" + cloudStoragePath, 'i');\r\n        var cloudStorageIndices = { bucket: 1, path: 2 };\r\n        var groups = [\r\n            { regex: gsRegex, indices: gsIndices, postModify: gsModify },\r\n            {\r\n                regex: firebaseStorageRegExp,\r\n                indices: firebaseStorageIndices,\r\n                postModify: httpModify\r\n            },\r\n            {\r\n                regex: cloudStorageRegExp,\r\n                indices: cloudStorageIndices,\r\n                postModify: httpModify\r\n            }\r\n        ];\r\n        for (var i = 0; i < groups.length; i++) {\r\n            var group = groups[i];\r\n            var captures = group.regex.exec(url);\r\n            if (captures) {\r\n                var bucketValue = captures[group.indices.bucket];\r\n                var pathValue = captures[group.indices.path];\r\n                if (!pathValue) {\r\n                    pathValue = '';\r\n                }\r\n                location = new Location(bucketValue, pathValue);\r\n                group.postModify(location);\r\n                break;\r\n            }\r\n        }\r\n        if (location == null) {\r\n            throw invalidUrl(url);\r\n        }\r\n        return location;\r\n    };\r\n    return Location;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns the Object resulting from parsing the given JSON, or null if the\r\n * given string does not represent a JSON object.\r\n */\r\nfunction jsonObjectOrNull(s) {\r\n    var obj;\r\n    try {\r\n        obj = JSON.parse(s);\r\n    }\r\n    catch (e) {\r\n        return null;\r\n    }\r\n    if (isNonArrayObject(obj)) {\r\n        return obj;\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Contains helper methods for manipulating paths.\r\n */\r\n/**\r\n * @return Null if the path is already at the root.\r\n */\r\nfunction parent(path) {\r\n    if (path.length === 0) {\r\n        return null;\r\n    }\r\n    var index = path.lastIndexOf('/');\r\n    if (index === -1) {\r\n        return '';\r\n    }\r\n    var newPath = path.slice(0, index);\r\n    return newPath;\r\n}\r\nfunction child(path, childPath) {\r\n    var canonicalChildPath = childPath\r\n        .split('/')\r\n        .filter(function (component) { return component.length > 0; })\r\n        .join('/');\r\n    if (path.length === 0) {\r\n        return canonicalChildPath;\r\n    }\r\n    else {\r\n        return path + '/' + canonicalChildPath;\r\n    }\r\n}\r\n/**\r\n * Returns the last component of a path.\r\n * '/foo/bar' -> 'bar'\r\n * '/foo/bar/baz/' -> 'baz/'\r\n * '/a' -> 'a'\r\n */\r\nfunction lastComponent(path) {\r\n    var index = path.lastIndexOf('/', path.length - 2);\r\n    if (index === -1) {\r\n        return path;\r\n    }\r\n    else {\r\n        return path.slice(index + 1);\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction makeUrl(urlPart) {\r\n    return \"https://\" + DEFAULT_HOST + \"/v0\" + urlPart;\r\n}\r\nfunction makeQueryString(params) {\r\n    var encode = encodeURIComponent;\r\n    var queryPart = '?';\r\n    for (var key in params) {\r\n        if (params.hasOwnProperty(key)) {\r\n            var nextPart = encode(key) + '=' + encode(params[key]);\r\n            queryPart = queryPart + nextPart + '&';\r\n        }\r\n    }\r\n    // Chop off the extra '&' or '?' on the end\r\n    queryPart = queryPart.slice(0, -1);\r\n    return queryPart;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction noXform_(metadata, value) {\r\n    return value;\r\n}\r\nvar Mapping = /** @class */ (function () {\r\n    function Mapping(server, local, writable, xform) {\r\n        this.server = server;\r\n        this.local = local || server;\r\n        this.writable = !!writable;\r\n        this.xform = xform || noXform_;\r\n    }\r\n    return Mapping;\r\n}());\r\nvar mappings_ = null;\r\nfunction xformPath(fullPath) {\r\n    if (!isString(fullPath) || fullPath.length < 2) {\r\n        return fullPath;\r\n    }\r\n    else {\r\n        return lastComponent(fullPath);\r\n    }\r\n}\r\nfunction getMappings() {\r\n    if (mappings_) {\r\n        return mappings_;\r\n    }\r\n    var mappings = [];\r\n    mappings.push(new Mapping('bucket'));\r\n    mappings.push(new Mapping('generation'));\r\n    mappings.push(new Mapping('metageneration'));\r\n    mappings.push(new Mapping('name', 'fullPath', true));\r\n    function mappingsXformPath(_metadata, fullPath) {\r\n        return xformPath(fullPath);\r\n    }\r\n    var nameMapping = new Mapping('name');\r\n    nameMapping.xform = mappingsXformPath;\r\n    mappings.push(nameMapping);\r\n    /**\r\n     * Coerces the second param to a number, if it is defined.\r\n     */\r\n    function xformSize(_metadata, size) {\r\n        if (size !== undefined) {\r\n            return Number(size);\r\n        }\r\n        else {\r\n            return size;\r\n        }\r\n    }\r\n    var sizeMapping = new Mapping('size');\r\n    sizeMapping.xform = xformSize;\r\n    mappings.push(sizeMapping);\r\n    mappings.push(new Mapping('timeCreated'));\r\n    mappings.push(new Mapping('updated'));\r\n    mappings.push(new Mapping('md5Hash', null, true));\r\n    mappings.push(new Mapping('cacheControl', null, true));\r\n    mappings.push(new Mapping('contentDisposition', null, true));\r\n    mappings.push(new Mapping('contentEncoding', null, true));\r\n    mappings.push(new Mapping('contentLanguage', null, true));\r\n    mappings.push(new Mapping('contentType', null, true));\r\n    mappings.push(new Mapping('metadata', 'customMetadata', true));\r\n    mappings_ = mappings;\r\n    return mappings_;\r\n}\r\nfunction addRef(metadata, service) {\r\n    function generateRef() {\r\n        var bucket = metadata['bucket'];\r\n        var path = metadata['fullPath'];\r\n        var loc = new Location(bucket, path);\r\n        return service.makeStorageReference(loc);\r\n    }\r\n    Object.defineProperty(metadata, 'ref', { get: generateRef });\r\n}\r\nfunction fromResource(service, resource, mappings) {\r\n    var metadata = {};\r\n    metadata['type'] = 'file';\r\n    var len = mappings.length;\r\n    for (var i = 0; i < len; i++) {\r\n        var mapping = mappings[i];\r\n        metadata[mapping.local] = mapping.xform(metadata, resource[mapping.server]);\r\n    }\r\n    addRef(metadata, service);\r\n    return metadata;\r\n}\r\nfunction fromResourceString(service, resourceString, mappings) {\r\n    var obj = jsonObjectOrNull(resourceString);\r\n    if (obj === null) {\r\n        return null;\r\n    }\r\n    var resource = obj;\r\n    return fromResource(service, resource, mappings);\r\n}\r\nfunction downloadUrlFromResourceString(metadata, resourceString) {\r\n    var obj = jsonObjectOrNull(resourceString);\r\n    if (obj === null) {\r\n        return null;\r\n    }\r\n    if (!isString(obj['downloadTokens'])) {\r\n        // This can happen if objects are uploaded through GCS and retrieved\r\n        // through list, so we don't want to throw an Error.\r\n        return null;\r\n    }\r\n    var tokens = obj['downloadTokens'];\r\n    if (tokens.length === 0) {\r\n        return null;\r\n    }\r\n    var encode = encodeURIComponent;\r\n    var tokensList = tokens.split(',');\r\n    var urls = tokensList.map(function (token) {\r\n        var bucket = metadata['bucket'];\r\n        var path = metadata['fullPath'];\r\n        var urlPart = '/b/' + encode(bucket) + '/o/' + encode(path);\r\n        var base = makeUrl(urlPart);\r\n        var queryString = makeQueryString({\r\n            alt: 'media',\r\n            token: token\r\n        });\r\n        return base + queryString;\r\n    });\r\n    return urls[0];\r\n}\r\nfunction toResourceString(metadata, mappings) {\r\n    var resource = {};\r\n    var len = mappings.length;\r\n    for (var i = 0; i < len; i++) {\r\n        var mapping = mappings[i];\r\n        if (mapping.writable) {\r\n            resource[mapping.server] = metadata[mapping.local];\r\n        }\r\n    }\r\n    return JSON.stringify(resource);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar PREFIXES_KEY = 'prefixes';\r\nvar ITEMS_KEY = 'items';\r\nfunction fromBackendResponse(service, bucket, resource) {\r\n    var listResult = {\r\n        prefixes: [],\r\n        items: [],\r\n        nextPageToken: resource['nextPageToken']\r\n    };\r\n    if (resource[PREFIXES_KEY]) {\r\n        for (var _i = 0, _a = resource[PREFIXES_KEY]; _i < _a.length; _i++) {\r\n            var path = _a[_i];\r\n            var pathWithoutTrailingSlash = path.replace(/\\/$/, '');\r\n            var reference = service.makeStorageReference(new Location(bucket, pathWithoutTrailingSlash));\r\n            listResult.prefixes.push(reference);\r\n        }\r\n    }\r\n    if (resource[ITEMS_KEY]) {\r\n        for (var _b = 0, _c = resource[ITEMS_KEY]; _b < _c.length; _b++) {\r\n            var item = _c[_b];\r\n            var reference = service.makeStorageReference(new Location(bucket, item['name']));\r\n            listResult.items.push(reference);\r\n        }\r\n    }\r\n    return listResult;\r\n}\r\nfunction fromResponseString(service, bucket, resourceString) {\r\n    var obj = jsonObjectOrNull(resourceString);\r\n    if (obj === null) {\r\n        return null;\r\n    }\r\n    var resource = obj;\r\n    return fromBackendResponse(service, bucket, resource);\r\n}\n\nvar RequestInfo = /** @class */ (function () {\r\n    function RequestInfo(url, method, \r\n    /**\r\n     * Returns the value with which to resolve the request's promise. Only called\r\n     * if the request is successful. Throw from this function to reject the\r\n     * returned Request's promise with the thrown error.\r\n     * Note: The XhrIo passed to this function may be reused after this callback\r\n     * returns. Do not keep a reference to it in any way.\r\n     */\r\n    handler, timeout) {\r\n        this.url = url;\r\n        this.method = method;\r\n        this.handler = handler;\r\n        this.timeout = timeout;\r\n        this.urlParams = {};\r\n        this.headers = {};\r\n        this.body = null;\r\n        this.errorHandler = null;\r\n        /**\r\n         * Called with the current number of bytes uploaded and total size (-1 if not\r\n         * computable) of the request body (i.e. used to report upload progress).\r\n         */\r\n        this.progressCallback = null;\r\n        this.successCodes = [200];\r\n        this.additionalRetryCodes = [];\r\n    }\r\n    return RequestInfo;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Throws the UNKNOWN FirebaseStorageError if cndn is false.\r\n */\r\nfunction handlerCheck(cndn) {\r\n    if (!cndn) {\r\n        throw unknown();\r\n    }\r\n}\r\nfunction metadataHandler(service, mappings) {\r\n    function handler(xhr, text) {\r\n        var metadata = fromResourceString(service, text, mappings);\r\n        handlerCheck(metadata !== null);\r\n        return metadata;\r\n    }\r\n    return handler;\r\n}\r\nfunction listHandler(service, bucket) {\r\n    function handler(xhr, text) {\r\n        var listResult = fromResponseString(service, bucket, text);\r\n        handlerCheck(listResult !== null);\r\n        return listResult;\r\n    }\r\n    return handler;\r\n}\r\nfunction downloadUrlHandler(service, mappings) {\r\n    function handler(xhr, text) {\r\n        var metadata = fromResourceString(service, text, mappings);\r\n        handlerCheck(metadata !== null);\r\n        return downloadUrlFromResourceString(metadata, text);\r\n    }\r\n    return handler;\r\n}\r\nfunction sharedErrorHandler(location) {\r\n    function errorHandler(xhr, err) {\r\n        var newErr;\r\n        if (xhr.getStatus() === 401) {\r\n            newErr = unauthenticated();\r\n        }\r\n        else {\r\n            if (xhr.getStatus() === 402) {\r\n                newErr = quotaExceeded(location.bucket);\r\n            }\r\n            else {\r\n                if (xhr.getStatus() === 403) {\r\n                    newErr = unauthorized(location.path);\r\n                }\r\n                else {\r\n                    newErr = err;\r\n                }\r\n            }\r\n        }\r\n        newErr.serverResponse = err.serverResponse;\r\n        return newErr;\r\n    }\r\n    return errorHandler;\r\n}\r\nfunction objectErrorHandler(location) {\r\n    var shared = sharedErrorHandler(location);\r\n    function errorHandler(xhr, err) {\r\n        var newErr = shared(xhr, err);\r\n        if (xhr.getStatus() === 404) {\r\n            newErr = objectNotFound(location.path);\r\n        }\r\n        newErr.serverResponse = err.serverResponse;\r\n        return newErr;\r\n    }\r\n    return errorHandler;\r\n}\r\nfunction getMetadata(service, location, mappings) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'GET';\r\n    var timeout = service.maxOperationRetryTime;\r\n    var requestInfo = new RequestInfo(url, method, metadataHandler(service, mappings), timeout);\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction list(service, location, delimiter, pageToken, maxResults) {\r\n    var urlParams = {};\r\n    if (location.isRoot) {\r\n        urlParams['prefix'] = '';\r\n    }\r\n    else {\r\n        urlParams['prefix'] = location.path + '/';\r\n    }\r\n    if (delimiter && delimiter.length > 0) {\r\n        urlParams['delimiter'] = delimiter;\r\n    }\r\n    if (pageToken) {\r\n        urlParams['pageToken'] = pageToken;\r\n    }\r\n    if (maxResults) {\r\n        urlParams['maxResults'] = maxResults;\r\n    }\r\n    var urlPart = location.bucketOnlyServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'GET';\r\n    var timeout = service.maxOperationRetryTime;\r\n    var requestInfo = new RequestInfo(url, method, listHandler(service, location.bucket), timeout);\r\n    requestInfo.urlParams = urlParams;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction getDownloadUrl(service, location, mappings) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'GET';\r\n    var timeout = service.maxOperationRetryTime;\r\n    var requestInfo = new RequestInfo(url, method, downloadUrlHandler(service, mappings), timeout);\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction updateMetadata(service, location, metadata, mappings) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'PATCH';\r\n    var body = toResourceString(metadata, mappings);\r\n    var headers = { 'Content-Type': 'application/json; charset=utf-8' };\r\n    var timeout = service.maxOperationRetryTime;\r\n    var requestInfo = new RequestInfo(url, method, metadataHandler(service, mappings), timeout);\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body;\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction deleteObject(service, location) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'DELETE';\r\n    var timeout = service.maxOperationRetryTime;\r\n    function handler(_xhr, _text) { }\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.successCodes = [200, 204];\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction determineContentType_(metadata, blob) {\r\n    return ((metadata && metadata['contentType']) ||\r\n        (blob && blob.type()) ||\r\n        'application/octet-stream');\r\n}\r\nfunction metadataForUpload_(location, blob, metadata) {\r\n    var metadataClone = Object.assign({}, metadata);\r\n    metadataClone['fullPath'] = location.path;\r\n    metadataClone['size'] = blob.size();\r\n    if (!metadataClone['contentType']) {\r\n        metadataClone['contentType'] = determineContentType_(null, blob);\r\n    }\r\n    return metadataClone;\r\n}\r\nfunction multipartUpload(service, location, mappings, blob, metadata) {\r\n    var urlPart = location.bucketOnlyServerUrl();\r\n    var headers = {\r\n        'X-Goog-Upload-Protocol': 'multipart'\r\n    };\r\n    function genBoundary() {\r\n        var str = '';\r\n        for (var i = 0; i < 2; i++) {\r\n            str = str + Math.random().toString().slice(2);\r\n        }\r\n        return str;\r\n    }\r\n    var boundary = genBoundary();\r\n    headers['Content-Type'] = 'multipart/related; boundary=' + boundary;\r\n    var metadata_ = metadataForUpload_(location, blob, metadata);\r\n    var metadataString = toResourceString(metadata_, mappings);\r\n    var preBlobPart = '--' +\r\n        boundary +\r\n        '\\r\\n' +\r\n        'Content-Type: application/json; charset=utf-8\\r\\n\\r\\n' +\r\n        metadataString +\r\n        '\\r\\n--' +\r\n        boundary +\r\n        '\\r\\n' +\r\n        'Content-Type: ' +\r\n        metadata_['contentType'] +\r\n        '\\r\\n\\r\\n';\r\n    var postBlobPart = '\\r\\n--' + boundary + '--';\r\n    var body = FbsBlob.getBlob(preBlobPart, blob, postBlobPart);\r\n    if (body === null) {\r\n        throw cannotSliceBlob();\r\n    }\r\n    var urlParams = { name: metadata_['fullPath'] };\r\n    var url = makeUrl(urlPart);\r\n    var method = 'POST';\r\n    var timeout = service.maxUploadRetryTime;\r\n    var requestInfo = new RequestInfo(url, method, metadataHandler(service, mappings), timeout);\r\n    requestInfo.urlParams = urlParams;\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body.uploadData();\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\n/**\r\n * @param current The number of bytes that have been uploaded so far.\r\n * @param total The total number of bytes in the upload.\r\n * @param opt_finalized True if the server has finished the upload.\r\n * @param opt_metadata The upload metadata, should\r\n *     only be passed if opt_finalized is true.\r\n */\r\nvar ResumableUploadStatus = /** @class */ (function () {\r\n    function ResumableUploadStatus(current, total, finalized, metadata) {\r\n        this.current = current;\r\n        this.total = total;\r\n        this.finalized = !!finalized;\r\n        this.metadata = metadata || null;\r\n    }\r\n    return ResumableUploadStatus;\r\n}());\r\nfunction checkResumeHeader_(xhr, allowed) {\r\n    var status = null;\r\n    try {\r\n        status = xhr.getResponseHeader('X-Goog-Upload-Status');\r\n    }\r\n    catch (e) {\r\n        handlerCheck(false);\r\n    }\r\n    var allowedStatus = allowed || ['active'];\r\n    handlerCheck(!!status && allowedStatus.indexOf(status) !== -1);\r\n    return status;\r\n}\r\nfunction createResumableUpload(service, location, mappings, blob, metadata) {\r\n    var urlPart = location.bucketOnlyServerUrl();\r\n    var metadataForUpload = metadataForUpload_(location, blob, metadata);\r\n    var urlParams = { name: metadataForUpload['fullPath'] };\r\n    var url = makeUrl(urlPart);\r\n    var method = 'POST';\r\n    var headers = {\r\n        'X-Goog-Upload-Protocol': 'resumable',\r\n        'X-Goog-Upload-Command': 'start',\r\n        'X-Goog-Upload-Header-Content-Length': blob.size(),\r\n        'X-Goog-Upload-Header-Content-Type': metadataForUpload['contentType'],\r\n        'Content-Type': 'application/json; charset=utf-8'\r\n    };\r\n    var body = toResourceString(metadataForUpload, mappings);\r\n    var timeout = service.maxUploadRetryTime;\r\n    function handler(xhr) {\r\n        checkResumeHeader_(xhr);\r\n        var url;\r\n        try {\r\n            url = xhr.getResponseHeader('X-Goog-Upload-URL');\r\n        }\r\n        catch (e) {\r\n            handlerCheck(false);\r\n        }\r\n        handlerCheck(isString(url));\r\n        return url;\r\n    }\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.urlParams = urlParams;\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\n/**\r\n * @param url From a call to fbs.requests.createResumableUpload.\r\n */\r\nfunction getResumableUploadStatus(service, location, url, blob) {\r\n    var headers = { 'X-Goog-Upload-Command': 'query' };\r\n    function handler(xhr) {\r\n        var status = checkResumeHeader_(xhr, ['active', 'final']);\r\n        var sizeString = null;\r\n        try {\r\n            sizeString = xhr.getResponseHeader('X-Goog-Upload-Size-Received');\r\n        }\r\n        catch (e) {\r\n            handlerCheck(false);\r\n        }\r\n        if (!sizeString) {\r\n            // null or empty string\r\n            handlerCheck(false);\r\n        }\r\n        var size = Number(sizeString);\r\n        handlerCheck(!isNaN(size));\r\n        return new ResumableUploadStatus(size, blob.size(), status === 'final');\r\n    }\r\n    var method = 'POST';\r\n    var timeout = service.maxUploadRetryTime;\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.headers = headers;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\n/**\r\n * Any uploads via the resumable upload API must transfer a number of bytes\r\n * that is a multiple of this number.\r\n */\r\nvar resumableUploadChunkSize = 256 * 1024;\r\n/**\r\n * @param url From a call to fbs.requests.createResumableUpload.\r\n * @param chunkSize Number of bytes to upload.\r\n * @param status The previous status.\r\n *     If not passed or null, we start from the beginning.\r\n * @throws fbs.Error If the upload is already complete, the passed in status\r\n *     has a final size inconsistent with the blob, or the blob cannot be sliced\r\n *     for upload.\r\n */\r\nfunction continueResumableUpload(location, service, url, blob, chunkSize, mappings, status, progressCallback) {\r\n    // TODO(andysoto): standardize on internal asserts\r\n    // assert(!(opt_status && opt_status.finalized));\r\n    var status_ = new ResumableUploadStatus(0, 0);\r\n    if (status) {\r\n        status_.current = status.current;\r\n        status_.total = status.total;\r\n    }\r\n    else {\r\n        status_.current = 0;\r\n        status_.total = blob.size();\r\n    }\r\n    if (blob.size() !== status_.total) {\r\n        throw serverFileWrongSize();\r\n    }\r\n    var bytesLeft = status_.total - status_.current;\r\n    var bytesToUpload = bytesLeft;\r\n    if (chunkSize > 0) {\r\n        bytesToUpload = Math.min(bytesToUpload, chunkSize);\r\n    }\r\n    var startByte = status_.current;\r\n    var endByte = startByte + bytesToUpload;\r\n    var uploadCommand = bytesToUpload === bytesLeft ? 'upload, finalize' : 'upload';\r\n    var headers = {\r\n        'X-Goog-Upload-Command': uploadCommand,\r\n        'X-Goog-Upload-Offset': status_.current\r\n    };\r\n    var body = blob.slice(startByte, endByte);\r\n    if (body === null) {\r\n        throw cannotSliceBlob();\r\n    }\r\n    function handler(xhr, text) {\r\n        // TODO(andysoto): Verify the MD5 of each uploaded range:\r\n        // the 'x-range-md5' header comes back with status code 308 responses.\r\n        // We'll only be able to bail out though, because you can't re-upload a\r\n        // range that you previously uploaded.\r\n        var uploadStatus = checkResumeHeader_(xhr, ['active', 'final']);\r\n        var newCurrent = status_.current + bytesToUpload;\r\n        var size = blob.size();\r\n        var metadata;\r\n        if (uploadStatus === 'final') {\r\n            metadata = metadataHandler(service, mappings)(xhr, text);\r\n        }\r\n        else {\r\n            metadata = null;\r\n        }\r\n        return new ResumableUploadStatus(newCurrent, size, uploadStatus === 'final', metadata);\r\n    }\r\n    var method = 'POST';\r\n    var timeout = service.maxUploadRetryTime;\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body.uploadData();\r\n    requestInfo.progressCallback = progressCallback || null;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar Observer = /** @class */ (function () {\r\n    function Observer(nextOrObserver, error, complete) {\r\n        var asFunctions = isFunction(nextOrObserver) || error != null || complete != null;\r\n        if (asFunctions) {\r\n            this.next = nextOrObserver;\r\n            this.error = error;\r\n            this.complete = complete;\r\n        }\r\n        else {\r\n            var observer = nextOrObserver;\r\n            this.next = observer.next;\r\n            this.error = observer.error;\r\n            this.complete = observer.complete;\r\n        }\r\n    }\r\n    return Observer;\r\n}());\n\nvar UploadTaskSnapshot = /** @class */ (function () {\r\n    function UploadTaskSnapshot(bytesTransferred, totalBytes, state, metadata, task, ref) {\r\n        this.bytesTransferred = bytesTransferred;\r\n        this.totalBytes = totalBytes;\r\n        this.state = state;\r\n        this.metadata = metadata;\r\n        this.task = task;\r\n        this.ref = ref;\r\n    }\r\n    return UploadTaskSnapshot;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a function that invokes f with its arguments asynchronously as a\r\n * microtask, i.e. as soon as possible after the current script returns back\r\n * into browser code.\r\n */\r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\nfunction async(f) {\r\n    return function () {\r\n        var argsToForward = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            argsToForward[_i] = arguments[_i];\r\n        }\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        Promise.resolve().then(function () { return f.apply(void 0, argsToForward); });\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Represents a blob being uploaded. Can be used to pause/resume/cancel the\r\n * upload and manage callbacks for various events.\r\n */\r\nvar UploadTask = /** @class */ (function () {\r\n    /**\r\n     * @param ref - The firebaseStorage.Reference object this task came\r\n     *     from, untyped to avoid cyclic dependencies.\r\n     * @param blob - The blob to upload.\r\n     */\r\n    function UploadTask(ref, blob, metadata) {\r\n        var _this = this;\r\n        if (metadata === void 0) { metadata = null; }\r\n        /**\r\n         * @internal\r\n         */\r\n        this._transferred = 0;\r\n        this._needToFetchStatus = false;\r\n        this._needToFetchMetadata = false;\r\n        this._observers = [];\r\n        this._error = undefined;\r\n        this._uploadUrl = undefined;\r\n        this._request = undefined;\r\n        this._chunkMultiplier = 1;\r\n        this._resolve = undefined;\r\n        this._reject = undefined;\r\n        this._ref = ref;\r\n        this._blob = blob;\r\n        this._metadata = metadata;\r\n        this._mappings = getMappings();\r\n        this._resumable = this._shouldDoResumable(this._blob);\r\n        this._state = InternalTaskState.RUNNING;\r\n        this._errorHandler = function (error) {\r\n            _this._request = undefined;\r\n            _this._chunkMultiplier = 1;\r\n            if (error.codeEquals(Code.CANCELED)) {\r\n                _this._needToFetchStatus = true;\r\n                _this.completeTransitions_();\r\n            }\r\n            else {\r\n                _this._error = error;\r\n                _this._transition(InternalTaskState.ERROR);\r\n            }\r\n        };\r\n        this._metadataErrorHandler = function (error) {\r\n            _this._request = undefined;\r\n            if (error.codeEquals(Code.CANCELED)) {\r\n                _this.completeTransitions_();\r\n            }\r\n            else {\r\n                _this._error = error;\r\n                _this._transition(InternalTaskState.ERROR);\r\n            }\r\n        };\r\n        this._promise = new Promise(function (resolve, reject) {\r\n            _this._resolve = resolve;\r\n            _this._reject = reject;\r\n            _this._start();\r\n        });\r\n        // Prevent uncaught rejections on the internal promise from bubbling out\r\n        // to the top level with a dummy handler.\r\n        this._promise.then(null, function () { });\r\n    }\r\n    UploadTask.prototype._makeProgressCallback = function () {\r\n        var _this = this;\r\n        var sizeBefore = this._transferred;\r\n        return function (loaded) { return _this._updateProgress(sizeBefore + loaded); };\r\n    };\r\n    UploadTask.prototype._shouldDoResumable = function (blob) {\r\n        return blob.size() > 256 * 1024;\r\n    };\r\n    UploadTask.prototype._start = function () {\r\n        if (this._state !== InternalTaskState.RUNNING) {\r\n            // This can happen if someone pauses us in a resume callback, for example.\r\n            return;\r\n        }\r\n        if (this._request !== undefined) {\r\n            return;\r\n        }\r\n        if (this._resumable) {\r\n            if (this._uploadUrl === undefined) {\r\n                this._createResumable();\r\n            }\r\n            else {\r\n                if (this._needToFetchStatus) {\r\n                    this._fetchStatus();\r\n                }\r\n                else {\r\n                    if (this._needToFetchMetadata) {\r\n                        // Happens if we miss the metadata on upload completion.\r\n                        this._fetchMetadata();\r\n                    }\r\n                    else {\r\n                        this._continueUpload();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this._oneShotUpload();\r\n        }\r\n    };\r\n    UploadTask.prototype._resolveToken = function (callback) {\r\n        var _this = this;\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this._ref.storage.getAuthToken().then(function (authToken) {\r\n            switch (_this._state) {\r\n                case InternalTaskState.RUNNING:\r\n                    callback(authToken);\r\n                    break;\r\n                case InternalTaskState.CANCELING:\r\n                    _this._transition(InternalTaskState.CANCELED);\r\n                    break;\r\n                case InternalTaskState.PAUSING:\r\n                    _this._transition(InternalTaskState.PAUSED);\r\n                    break;\r\n            }\r\n        });\r\n    };\r\n    // TODO(andysoto): assert false\r\n    UploadTask.prototype._createResumable = function () {\r\n        var _this = this;\r\n        this._resolveToken(function (authToken) {\r\n            var requestInfo = createResumableUpload(_this._ref.storage, _this._ref._location, _this._mappings, _this._blob, _this._metadata);\r\n            var createRequest = _this._ref.storage.makeRequest(requestInfo, authToken);\r\n            _this._request = createRequest;\r\n            createRequest.getPromise().then(function (url) {\r\n                _this._request = undefined;\r\n                _this._uploadUrl = url;\r\n                _this._needToFetchStatus = false;\r\n                _this.completeTransitions_();\r\n            }, _this._errorHandler);\r\n        });\r\n    };\r\n    UploadTask.prototype._fetchStatus = function () {\r\n        var _this = this;\r\n        // TODO(andysoto): assert(this.uploadUrl_ !== null);\r\n        var url = this._uploadUrl;\r\n        this._resolveToken(function (authToken) {\r\n            var requestInfo = getResumableUploadStatus(_this._ref.storage, _this._ref._location, url, _this._blob);\r\n            var statusRequest = _this._ref.storage.makeRequest(requestInfo, authToken);\r\n            _this._request = statusRequest;\r\n            statusRequest.getPromise().then(function (status) {\r\n                status = status;\r\n                _this._request = undefined;\r\n                _this._updateProgress(status.current);\r\n                _this._needToFetchStatus = false;\r\n                if (status.finalized) {\r\n                    _this._needToFetchMetadata = true;\r\n                }\r\n                _this.completeTransitions_();\r\n            }, _this._errorHandler);\r\n        });\r\n    };\r\n    UploadTask.prototype._continueUpload = function () {\r\n        var _this = this;\r\n        var chunkSize = resumableUploadChunkSize * this._chunkMultiplier;\r\n        var status = new ResumableUploadStatus(this._transferred, this._blob.size());\r\n        // TODO(andysoto): assert(this.uploadUrl_ !== null);\r\n        var url = this._uploadUrl;\r\n        this._resolveToken(function (authToken) {\r\n            var requestInfo;\r\n            try {\r\n                requestInfo = continueResumableUpload(_this._ref._location, _this._ref.storage, url, _this._blob, chunkSize, _this._mappings, status, _this._makeProgressCallback());\r\n            }\r\n            catch (e) {\r\n                _this._error = e;\r\n                _this._transition(InternalTaskState.ERROR);\r\n                return;\r\n            }\r\n            var uploadRequest = _this._ref.storage.makeRequest(requestInfo, authToken);\r\n            _this._request = uploadRequest;\r\n            uploadRequest\r\n                .getPromise()\r\n                .then(function (newStatus) {\r\n                _this._increaseMultiplier();\r\n                _this._request = undefined;\r\n                _this._updateProgress(newStatus.current);\r\n                if (newStatus.finalized) {\r\n                    _this._metadata = newStatus.metadata;\r\n                    _this._transition(InternalTaskState.SUCCESS);\r\n                }\r\n                else {\r\n                    _this.completeTransitions_();\r\n                }\r\n            }, _this._errorHandler);\r\n        });\r\n    };\r\n    UploadTask.prototype._increaseMultiplier = function () {\r\n        var currentSize = resumableUploadChunkSize * this._chunkMultiplier;\r\n        // Max chunk size is 32M.\r\n        if (currentSize < 32 * 1024 * 1024) {\r\n            this._chunkMultiplier *= 2;\r\n        }\r\n    };\r\n    UploadTask.prototype._fetchMetadata = function () {\r\n        var _this = this;\r\n        this._resolveToken(function (authToken) {\r\n            var requestInfo = getMetadata(_this._ref.storage, _this._ref._location, _this._mappings);\r\n            var metadataRequest = _this._ref.storage.makeRequest(requestInfo, authToken);\r\n            _this._request = metadataRequest;\r\n            metadataRequest.getPromise().then(function (metadata) {\r\n                _this._request = undefined;\r\n                _this._metadata = metadata;\r\n                _this._transition(InternalTaskState.SUCCESS);\r\n            }, _this._metadataErrorHandler);\r\n        });\r\n    };\r\n    UploadTask.prototype._oneShotUpload = function () {\r\n        var _this = this;\r\n        this._resolveToken(function (authToken) {\r\n            var requestInfo = multipartUpload(_this._ref.storage, _this._ref._location, _this._mappings, _this._blob, _this._metadata);\r\n            var multipartRequest = _this._ref.storage.makeRequest(requestInfo, authToken);\r\n            _this._request = multipartRequest;\r\n            multipartRequest.getPromise().then(function (metadata) {\r\n                _this._request = undefined;\r\n                _this._metadata = metadata;\r\n                _this._updateProgress(_this._blob.size());\r\n                _this._transition(InternalTaskState.SUCCESS);\r\n            }, _this._errorHandler);\r\n        });\r\n    };\r\n    UploadTask.prototype._updateProgress = function (transferred) {\r\n        var old = this._transferred;\r\n        this._transferred = transferred;\r\n        // A progress update can make the \"transferred\" value smaller (e.g. a\r\n        // partial upload not completed by server, after which the \"transferred\"\r\n        // value may reset to the value at the beginning of the request).\r\n        if (this._transferred !== old) {\r\n            this._notifyObservers();\r\n        }\r\n    };\r\n    UploadTask.prototype._transition = function (state) {\r\n        if (this._state === state) {\r\n            return;\r\n        }\r\n        switch (state) {\r\n            case InternalTaskState.CANCELING:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING ||\r\n                //        this.state_ === InternalTaskState.PAUSING);\r\n                this._state = state;\r\n                if (this._request !== undefined) {\r\n                    this._request.cancel();\r\n                }\r\n                break;\r\n            case InternalTaskState.PAUSING:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING);\r\n                this._state = state;\r\n                if (this._request !== undefined) {\r\n                    this._request.cancel();\r\n                }\r\n                break;\r\n            case InternalTaskState.RUNNING:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.PAUSED ||\r\n                //        this.state_ === InternalTaskState.PAUSING);\r\n                var wasPaused = this._state === InternalTaskState.PAUSED;\r\n                this._state = state;\r\n                if (wasPaused) {\r\n                    this._notifyObservers();\r\n                    this._start();\r\n                }\r\n                break;\r\n            case InternalTaskState.PAUSED:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.PAUSING);\r\n                this._state = state;\r\n                this._notifyObservers();\r\n                break;\r\n            case InternalTaskState.CANCELED:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.PAUSED ||\r\n                //        this.state_ === InternalTaskState.CANCELING);\r\n                this._error = canceled();\r\n                this._state = state;\r\n                this._notifyObservers();\r\n                break;\r\n            case InternalTaskState.ERROR:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING ||\r\n                //        this.state_ === InternalTaskState.PAUSING ||\r\n                //        this.state_ === InternalTaskState.CANCELING);\r\n                this._state = state;\r\n                this._notifyObservers();\r\n                break;\r\n            case InternalTaskState.SUCCESS:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING ||\r\n                //        this.state_ === InternalTaskState.PAUSING ||\r\n                //        this.state_ === InternalTaskState.CANCELING);\r\n                this._state = state;\r\n                this._notifyObservers();\r\n                break;\r\n        }\r\n    };\r\n    UploadTask.prototype.completeTransitions_ = function () {\r\n        switch (this._state) {\r\n            case InternalTaskState.PAUSING:\r\n                this._transition(InternalTaskState.PAUSED);\r\n                break;\r\n            case InternalTaskState.CANCELING:\r\n                this._transition(InternalTaskState.CANCELED);\r\n                break;\r\n            case InternalTaskState.RUNNING:\r\n                this._start();\r\n                break;\r\n        }\r\n    };\r\n    Object.defineProperty(UploadTask.prototype, \"snapshot\", {\r\n        get: function () {\r\n            var externalState = taskStateFromInternalTaskState(this._state);\r\n            return new UploadTaskSnapshot(this._transferred, this._blob.size(), externalState, this._metadata, this, this._ref);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Adds a callback for an event.\r\n     * @param type - The type of event to listen for.\r\n     */\r\n    UploadTask.prototype.on = function (type, nextOrObserver, error, completed) {\r\n        var _this = this;\r\n        var observer = new Observer(nextOrObserver, error, completed);\r\n        this._addObserver(observer);\r\n        return function () {\r\n            _this._removeObserver(observer);\r\n        };\r\n    };\r\n    /**\r\n     * This object behaves like a Promise, and resolves with its snapshot data\r\n     * when the upload completes.\r\n     * @param onFulfilled - The fulfillment callback. Promise chaining works as normal.\r\n     * @param onRejected - The rejection callback.\r\n     */\r\n    UploadTask.prototype.then = function (onFulfilled, onRejected) {\r\n        // These casts are needed so that TypeScript can infer the types of the\r\n        // resulting Promise.\r\n        return this._promise.then(onFulfilled, onRejected);\r\n    };\r\n    /**\r\n     * Equivalent to calling `then(null, onRejected)`.\r\n     */\r\n    UploadTask.prototype.catch = function (onRejected) {\r\n        return this.then(null, onRejected);\r\n    };\r\n    /**\r\n     * Adds the given observer.\r\n     */\r\n    UploadTask.prototype._addObserver = function (observer) {\r\n        this._observers.push(observer);\r\n        this._notifyObserver(observer);\r\n    };\r\n    /**\r\n     * Removes the given observer.\r\n     */\r\n    UploadTask.prototype._removeObserver = function (observer) {\r\n        var i = this._observers.indexOf(observer);\r\n        if (i !== -1) {\r\n            this._observers.splice(i, 1);\r\n        }\r\n    };\r\n    UploadTask.prototype._notifyObservers = function () {\r\n        var _this = this;\r\n        this._finishPromise();\r\n        var observers = this._observers.slice();\r\n        observers.forEach(function (observer) {\r\n            _this._notifyObserver(observer);\r\n        });\r\n    };\r\n    UploadTask.prototype._finishPromise = function () {\r\n        if (this._resolve !== undefined) {\r\n            var triggered = true;\r\n            switch (taskStateFromInternalTaskState(this._state)) {\r\n                case TaskState.SUCCESS:\r\n                    async(this._resolve.bind(null, this.snapshot))();\r\n                    break;\r\n                case TaskState.CANCELED:\r\n                case TaskState.ERROR:\r\n                    var toCall = this._reject;\r\n                    async(toCall.bind(null, this._error))();\r\n                    break;\r\n                default:\r\n                    triggered = false;\r\n                    break;\r\n            }\r\n            if (triggered) {\r\n                this._resolve = undefined;\r\n                this._reject = undefined;\r\n            }\r\n        }\r\n    };\r\n    UploadTask.prototype._notifyObserver = function (observer) {\r\n        var externalState = taskStateFromInternalTaskState(this._state);\r\n        switch (externalState) {\r\n            case TaskState.RUNNING:\r\n            case TaskState.PAUSED:\r\n                if (observer.next) {\r\n                    async(observer.next.bind(observer, this.snapshot))();\r\n                }\r\n                break;\r\n            case TaskState.SUCCESS:\r\n                if (observer.complete) {\r\n                    async(observer.complete.bind(observer))();\r\n                }\r\n                break;\r\n            case TaskState.CANCELED:\r\n            case TaskState.ERROR:\r\n                if (observer.error) {\r\n                    async(observer.error.bind(observer, this._error))();\r\n                }\r\n                break;\r\n            default:\r\n                // TODO(andysoto): assert(false);\r\n                if (observer.error) {\r\n                    async(observer.error.bind(observer, this._error))();\r\n                }\r\n        }\r\n    };\r\n    /**\r\n     * Resumes a paused task. Has no effect on a currently running or failed task.\r\n     * @returns True if the operation took effect, false if ignored.\r\n     */\r\n    UploadTask.prototype.resume = function () {\r\n        var valid = this._state === InternalTaskState.PAUSED ||\r\n            this._state === InternalTaskState.PAUSING;\r\n        if (valid) {\r\n            this._transition(InternalTaskState.RUNNING);\r\n        }\r\n        return valid;\r\n    };\r\n    /**\r\n     * Pauses a currently running task. Has no effect on a paused or failed task.\r\n     * @returns True if the operation took effect, false if ignored.\r\n     */\r\n    UploadTask.prototype.pause = function () {\r\n        var valid = this._state === InternalTaskState.RUNNING;\r\n        if (valid) {\r\n            this._transition(InternalTaskState.PAUSING);\r\n        }\r\n        return valid;\r\n    };\r\n    /**\r\n     * Cancels a currently running or paused task. Has no effect on a complete or\r\n     * failed task.\r\n     * @returns True if the operation took effect, false if ignored.\r\n     */\r\n    UploadTask.prototype.cancel = function () {\r\n        var valid = this._state === InternalTaskState.RUNNING ||\r\n            this._state === InternalTaskState.PAUSING;\r\n        if (valid) {\r\n            this._transition(InternalTaskState.CANCELING);\r\n        }\r\n        return valid;\r\n    };\r\n    return UploadTask;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Provides methods to interact with a bucket in the Firebase Storage service.\r\n * @param location - An fbs.location, or the URL at\r\n *     which to base this object, in one of the following forms:\r\n *         gs://<bucket>/<object-path>\r\n *         http[s]://firebasestorage.googleapis.com/\r\n *                     <api-version>/b/<bucket>/o/<object-path>\r\n *     Any query or fragment strings will be ignored in the http[s]\r\n *     format. If no value is passed, the storage object will use a URL based on\r\n *     the project ID of the base firebase.App instance.\r\n */\r\nvar Reference = /** @class */ (function () {\r\n    function Reference(_service, location) {\r\n        this._service = _service;\r\n        if (location instanceof Location) {\r\n            this._location = location;\r\n        }\r\n        else {\r\n            this._location = Location.makeFromUrl(location);\r\n        }\r\n    }\r\n    /**\r\n     * @returns The URL for the bucket and path this object references,\r\n     *     in the form gs://<bucket>/<object-path>\r\n     * @override\r\n     */\r\n    Reference.prototype.toString = function () {\r\n        return 'gs://' + this._location.bucket + '/' + this._location.path;\r\n    };\r\n    Reference.prototype.newRef = function (service, location) {\r\n        return new Reference(service, location);\r\n    };\r\n    Object.defineProperty(Reference.prototype, \"root\", {\r\n        /**\r\n         * @returns An reference to the root of this\r\n         *     object's bucket.\r\n         */\r\n        get: function () {\r\n            var location = new Location(this._location.bucket, '');\r\n            return this.newRef(this._service, location);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"bucket\", {\r\n        get: function () {\r\n            return this._location.bucket;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"fullPath\", {\r\n        get: function () {\r\n            return this._location.path;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"name\", {\r\n        get: function () {\r\n            return lastComponent(this._location.path);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"storage\", {\r\n        get: function () {\r\n            return this._service;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"parent\", {\r\n        get: function () {\r\n            var newPath = parent(this._location.path);\r\n            if (newPath === null) {\r\n                return null;\r\n            }\r\n            var location = new Location(this._location.bucket, newPath);\r\n            return new Reference(this._service, location);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Reference.prototype._throwIfRoot = function (name) {\r\n        if (this._location.path === '') {\r\n            throw invalidRootOperation(name);\r\n        }\r\n    };\r\n    return Reference;\r\n}());\r\n/**\r\n * Uploads a blob to this object's location.\r\n * @public\r\n * @param ref - Storage Reference where data should be uploaded.\r\n * @param data - The data to upload.\r\n * @param metadata - Metadata for the newly uploaded string.\r\n * @returns An UploadTask that lets you control and\r\n *     observe the upload.\r\n */\r\nfunction uploadBytesResumable(ref, data, metadata) {\r\n    if (metadata === void 0) { metadata = null; }\r\n    ref._throwIfRoot('uploadBytesResumable');\r\n    return new UploadTask(ref, new FbsBlob(data), metadata);\r\n}\r\n/**\r\n * Uploads a string to this object's location.\r\n * @public\r\n * @param ref - Storage Reference where string should be uploaded.\r\n * @param value - The string to upload.\r\n * @param format - The format of the string to upload.\r\n * @param metadata - Metadata for the newly uploaded object.\r\n * @returns An UploadTask that lets you control and\r\n *     observe the upload.\r\n */\r\nfunction uploadString(ref, value, format, metadata) {\r\n    if (format === void 0) { format = StringFormat.RAW; }\r\n    ref._throwIfRoot('putString');\r\n    var data = dataFromString(format, value);\r\n    var metadataClone = __assign({}, metadata);\r\n    if (metadataClone['contentType'] == null && data.contentType != null) {\r\n        metadataClone['contentType'] = data.contentType;\r\n    }\r\n    return new UploadTask(ref, new FbsBlob(data.data, true), metadataClone);\r\n}\r\n/**\r\n * List all items (files) and prefixes (folders) under this storage reference.\r\n *\r\n * This is a helper method for calling list() repeatedly until there are\r\n * no more results. The default pagination size is 1000.\r\n *\r\n * Note: The results may not be consistent if objects are changed while this\r\n * operation is running.\r\n *\r\n * Warning: listAll may potentially consume too many resources if there are\r\n * too many results.\r\n * @public\r\n * @param ref - Storage Reference to get list from.\r\n *\r\n * @returns A Promise that resolves with all the items and prefixes under\r\n *      the current storage reference. `prefixes` contains references to\r\n *      sub-directories and `items` contains references to objects in this\r\n *      folder. `nextPageToken` is never returned.\r\n */\r\nfunction listAll(ref) {\r\n    var accumulator = {\r\n        prefixes: [],\r\n        items: []\r\n    };\r\n    return listAllHelper(ref, accumulator).then(function () { return accumulator; });\r\n}\r\n/**\r\n * Separated from listAll because async functions can't use \"arguments\".\r\n * @internal\r\n * @param ref\r\n * @param accumulator\r\n * @param pageToken\r\n */\r\nfunction listAllHelper(ref, accumulator, pageToken) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var opt, nextPage;\r\n        var _a, _b;\r\n        return __generator(this, function (_c) {\r\n            switch (_c.label) {\r\n                case 0:\r\n                    opt = {\r\n                        // maxResults is 1000 by default.\r\n                        pageToken: pageToken\r\n                    };\r\n                    return [4 /*yield*/, list$1(ref, opt)];\r\n                case 1:\r\n                    nextPage = _c.sent();\r\n                    (_a = accumulator.prefixes).push.apply(_a, nextPage.prefixes);\r\n                    (_b = accumulator.items).push.apply(_b, nextPage.items);\r\n                    if (!(nextPage.nextPageToken != null)) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, listAllHelper(ref, accumulator, nextPage.nextPageToken)];\r\n                case 2:\r\n                    _c.sent();\r\n                    _c.label = 3;\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * List items (files) and prefixes (folders) under this storage reference.\r\n *\r\n * List API is only available for Firebase Rules Version 2.\r\n *\r\n * GCS is a key-blob store. Firebase Storage imposes the semantic of '/'\r\n * delimited folder structure.\r\n * Refer to GCS's List API if you want to learn more.\r\n *\r\n * To adhere to Firebase Rules's Semantics, Firebase Storage does not\r\n * support objects whose paths end with \"/\" or contain two consecutive\r\n * \"/\"s. Firebase Storage List API will filter these unsupported objects.\r\n * list() may fail if there are too many unsupported objects in the bucket.\r\n * @public\r\n *\r\n * @param ref - Storage Reference to get list from.\r\n * @param options - See ListOptions for details.\r\n * @returns A Promise that resolves with the items and prefixes.\r\n *      `prefixes` contains references to sub-folders and `items`\r\n *      contains references to objects in this folder. `nextPageToken`\r\n *      can be used to get the rest of the results.\r\n */\r\nfunction list$1(ref, options) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken, op, requestInfo;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (options != null) {\r\n                        if (typeof options.maxResults === 'number') {\r\n                            validateNumber('options.maxResults', \r\n                            /* minValue= */ 1, \r\n                            /* maxValue= */ 1000, options.maxResults);\r\n                        }\r\n                    }\r\n                    return [4 /*yield*/, ref.storage.getAuthToken()];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    op = options || {};\r\n                    requestInfo = list(ref.storage, ref._location, \r\n                    /*delimiter= */ '/', op.pageToken, op.maxResults);\r\n                    return [2 /*return*/, ref.storage.makeRequest(requestInfo, authToken).getPromise()];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * A promise that resolves with the metadata for this object. If this\r\n * object doesn't exist or metadata cannot be retreived, the promise is\r\n * rejected.\r\n * @public\r\n * @param ref - Storage Reference to get metadata from.\r\n */\r\nfunction getMetadata$1(ref) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken, requestInfo;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    ref._throwIfRoot('getMetadata');\r\n                    return [4 /*yield*/, ref.storage.getAuthToken()];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    requestInfo = getMetadata(ref.storage, ref._location, getMappings());\r\n                    return [2 /*return*/, ref.storage.makeRequest(requestInfo, authToken).getPromise()];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Updates the metadata for this object.\r\n * @public\r\n * @param ref - Storage Reference to update metadata for.\r\n * @param metadata - The new metadata for the object.\r\n *     Only values that have been explicitly set will be changed. Explicitly\r\n *     setting a value to null will remove the metadata.\r\n * @returns A promise that resolves\r\n *     with the new metadata for this object.\r\n *     See `firebaseStorage.Reference.prototype.getMetadata`\r\n */\r\nfunction updateMetadata$1(ref, metadata) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken, requestInfo;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    ref._throwIfRoot('updateMetadata');\r\n                    return [4 /*yield*/, ref.storage.getAuthToken()];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    requestInfo = updateMetadata(ref.storage, ref._location, metadata, getMappings());\r\n                    return [2 /*return*/, ref.storage.makeRequest(requestInfo, authToken).getPromise()];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Returns the download URL for the given Reference.\r\n * @public\r\n * @returns A promise that resolves with the download\r\n *     URL for this object.\r\n */\r\nfunction getDownloadURL(ref) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken, requestInfo;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    ref._throwIfRoot('getDownloadURL');\r\n                    return [4 /*yield*/, ref.storage.getAuthToken()];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    requestInfo = getDownloadUrl(ref.storage, ref._location, getMappings());\r\n                    return [2 /*return*/, ref.storage\r\n                            .makeRequest(requestInfo, authToken)\r\n                            .getPromise()\r\n                            .then(function (url) {\r\n                            if (url === null) {\r\n                                throw noDownloadURL();\r\n                            }\r\n                            return url;\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Deletes the object at this location.\r\n * @public\r\n * @param ref - Storage Reference for object to delete.\r\n * @returns A promise that resolves if the deletion succeeds.\r\n */\r\nfunction deleteObject$1(ref) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken, requestInfo;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    ref._throwIfRoot('deleteObject');\r\n                    return [4 /*yield*/, ref.storage.getAuthToken()];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    requestInfo = deleteObject(ref.storage, ref._location);\r\n                    return [2 /*return*/, ref.storage.makeRequest(requestInfo, authToken).getPromise()];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Returns reference for object obtained by appending `childPath` to `ref`.\r\n * @internal\r\n *\r\n * @param ref - Storage Reference to get child of.\r\n * @param childPath - Child path from provided ref.\r\n * @returns A reference to the object obtained by\r\n * appending childPath, removing any duplicate, beginning, or trailing\r\n * slashes.\r\n */\r\nfunction getChild(ref, childPath) {\r\n    var newPath = child(ref._location.path, childPath);\r\n    var location = new Location(ref._location.bucket, newPath);\r\n    return new Reference(ref.storage, location);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar UploadTaskSnapshotCompat = /** @class */ (function () {\r\n    function UploadTaskSnapshotCompat(_delegate, task, ref) {\r\n        this._delegate = _delegate;\r\n        this.task = task;\r\n        this.ref = ref;\r\n    }\r\n    Object.defineProperty(UploadTaskSnapshotCompat.prototype, \"bytesTransferred\", {\r\n        get: function () {\r\n            return this._delegate.bytesTransferred;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UploadTaskSnapshotCompat.prototype, \"metadata\", {\r\n        get: function () {\r\n            return this._delegate.metadata;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UploadTaskSnapshotCompat.prototype, \"state\", {\r\n        get: function () {\r\n            return this._delegate.state;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(UploadTaskSnapshotCompat.prototype, \"totalBytes\", {\r\n        get: function () {\r\n            return this._delegate.totalBytes;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return UploadTaskSnapshotCompat;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar UploadTaskCompat = /** @class */ (function () {\r\n    function UploadTaskCompat(_delegate, _ref) {\r\n        this._delegate = _delegate;\r\n        this._ref = _ref;\r\n        this.cancel = this._delegate.cancel.bind(this._delegate);\r\n        this.catch = this._delegate.catch.bind(this._delegate);\r\n        this.pause = this._delegate.pause.bind(this._delegate);\r\n        this.resume = this._delegate.resume.bind(this._delegate);\r\n        this._snapshot = new UploadTaskSnapshotCompat(this._delegate.snapshot, this, this._ref);\r\n    }\r\n    Object.defineProperty(UploadTaskCompat.prototype, \"snapshot\", {\r\n        get: function () {\r\n            return this._snapshot;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    UploadTaskCompat.prototype.then = function (onFulfilled, onRejected) {\r\n        var _this = this;\r\n        return this._delegate.then(function (snapshot) {\r\n            if (onFulfilled) {\r\n                return onFulfilled(new UploadTaskSnapshotCompat(snapshot, _this, _this._ref));\r\n            }\r\n        }, onRejected);\r\n    };\r\n    UploadTaskCompat.prototype.on = function (type, nextOrObserver, error, completed) {\r\n        var _this = this;\r\n        var wrappedNextOrObserver = undefined;\r\n        if (!!nextOrObserver) {\r\n            if (typeof nextOrObserver === 'function') {\r\n                wrappedNextOrObserver = function (taskSnapshot) {\r\n                    return nextOrObserver(new UploadTaskSnapshotCompat(taskSnapshot, _this, _this._ref));\r\n                };\r\n            }\r\n            else {\r\n                wrappedNextOrObserver = {\r\n                    next: !!nextOrObserver.next\r\n                        ? function (taskSnapshot) {\r\n                            return nextOrObserver.next(new UploadTaskSnapshotCompat(taskSnapshot, _this, _this._ref));\r\n                        }\r\n                        : undefined,\r\n                    complete: nextOrObserver.complete || undefined,\r\n                    error: nextOrObserver.error || undefined\r\n                };\r\n            }\r\n        }\r\n        return this._delegate.on(type, wrappedNextOrObserver, error || undefined, completed || undefined);\r\n    };\r\n    return UploadTaskCompat;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar ListResultCompat = /** @class */ (function () {\r\n    function ListResultCompat(_delegate, _service) {\r\n        this._delegate = _delegate;\r\n        this._service = _service;\r\n    }\r\n    Object.defineProperty(ListResultCompat.prototype, \"prefixes\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._delegate.prefixes.map(function (ref) { return new ReferenceCompat(ref, _this._service); });\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ListResultCompat.prototype, \"items\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._delegate.items.map(function (ref) { return new ReferenceCompat(ref, _this._service); });\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ListResultCompat.prototype, \"nextPageToken\", {\r\n        get: function () {\r\n            return this._delegate.nextPageToken || null;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return ListResultCompat;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *  http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar ReferenceCompat = /** @class */ (function () {\r\n    function ReferenceCompat(_delegate, storage) {\r\n        this._delegate = _delegate;\r\n        this.storage = storage;\r\n    }\r\n    Object.defineProperty(ReferenceCompat.prototype, \"name\", {\r\n        get: function () {\r\n            return this._delegate.name;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReferenceCompat.prototype, \"bucket\", {\r\n        get: function () {\r\n            return this._delegate.bucket;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReferenceCompat.prototype, \"fullPath\", {\r\n        get: function () {\r\n            return this._delegate.fullPath;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    ReferenceCompat.prototype.toString = function () {\r\n        return this._delegate.toString();\r\n    };\r\n    /**\r\n     * @returns A reference to the object obtained by\r\n     * appending childPath, removing any duplicate, beginning, or trailing\r\n     * slashes.\r\n     */\r\n    ReferenceCompat.prototype.child = function (childPath) {\r\n        var reference = getChild(this._delegate, childPath);\r\n        return new ReferenceCompat(reference, this.storage);\r\n    };\r\n    Object.defineProperty(ReferenceCompat.prototype, \"root\", {\r\n        get: function () {\r\n            return new ReferenceCompat(this._delegate.root, this.storage);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReferenceCompat.prototype, \"parent\", {\r\n        /**\r\n         * @returns A reference to the parent of the\r\n         * current object, or null if the current object is the root.\r\n         */\r\n        get: function () {\r\n            var reference = this._delegate.parent;\r\n            if (reference == null) {\r\n                return null;\r\n            }\r\n            return new ReferenceCompat(reference, this.storage);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Uploads a blob to this object's location.\r\n     * @param data - The blob to upload.\r\n     * @returns An UploadTask that lets you control and\r\n     * observe the upload.\r\n     */\r\n    ReferenceCompat.prototype.put = function (data, metadata) {\r\n        this._throwIfRoot('put');\r\n        return new UploadTaskCompat(uploadBytesResumable(this._delegate, data, metadata), this);\r\n    };\r\n    /**\r\n     * Uploads a string to this object's location.\r\n     * @param value - The string to upload.\r\n     * @param format - The format of the string to upload.\r\n     * @returns An UploadTask that lets you control and\r\n     * observe the upload.\r\n     */\r\n    ReferenceCompat.prototype.putString = function (value, format, metadata) {\r\n        if (format === void 0) { format = StringFormat.RAW; }\r\n        this._throwIfRoot('putString');\r\n        return new UploadTaskCompat(uploadString(this._delegate, value, format, metadata), this);\r\n    };\r\n    /**\r\n     * List all items (files) and prefixes (folders) under this storage reference.\r\n     *\r\n     * This is a helper method for calling list() repeatedly until there are\r\n     * no more results. The default pagination size is 1000.\r\n     *\r\n     * Note: The results may not be consistent if objects are changed while this\r\n     * operation is running.\r\n     *\r\n     * Warning: listAll may potentially consume too many resources if there are\r\n     * too many results.\r\n     *\r\n     * @returns A Promise that resolves with all the items and prefixes under\r\n     *  the current storage reference. `prefixes` contains references to\r\n     *  sub-directories and `items` contains references to objects in this\r\n     *  folder. `nextPageToken` is never returned.\r\n     */\r\n    ReferenceCompat.prototype.listAll = function () {\r\n        var _this = this;\r\n        return listAll(this._delegate).then(function (r) { return new ListResultCompat(r, _this.storage); });\r\n    };\r\n    /**\r\n     * List items (files) and prefixes (folders) under this storage reference.\r\n     *\r\n     * List API is only available for Firebase Rules Version 2.\r\n     *\r\n     * GCS is a key-blob store. Firebase Storage imposes the semantic of '/'\r\n     * delimited folder structure. Refer to GCS's List API if you want to learn more.\r\n     *\r\n     * To adhere to Firebase Rules's Semantics, Firebase Storage does not\r\n     * support objects whose paths end with \"/\" or contain two consecutive\r\n     * \"/\"s. Firebase Storage List API will filter these unsupported objects.\r\n     * list() may fail if there are too many unsupported objects in the bucket.\r\n     *\r\n     * @param options - See ListOptions for details.\r\n     * @returns A Promise that resolves with the items and prefixes.\r\n     * `prefixes` contains references to sub-folders and `items`\r\n     * contains references to objects in this folder. `nextPageToken`\r\n     * can be used to get the rest of the results.\r\n     */\r\n    ReferenceCompat.prototype.list = function (options) {\r\n        var _this = this;\r\n        return list$1(this._delegate, options).then(function (r) { return new ListResultCompat(r, _this.storage); });\r\n    };\r\n    /**\r\n     * A promise that resolves with the metadata for this object. If this\r\n     * object doesn't exist or metadata cannot be retreived, the promise is\r\n     * rejected.\r\n     */\r\n    ReferenceCompat.prototype.getMetadata = function () {\r\n        return getMetadata$1(this._delegate);\r\n    };\r\n    /**\r\n     * Updates the metadata for this object.\r\n     * @param metadata - The new metadata for the object.\r\n     * Only values that have been explicitly set will be changed. Explicitly\r\n     * setting a value to null will remove the metadata.\r\n     * @returns A promise that resolves\r\n     * with the new metadata for this object.\r\n     * @see firebaseStorage.Reference.prototype.getMetadata\r\n     */\r\n    ReferenceCompat.prototype.updateMetadata = function (metadata) {\r\n        return updateMetadata$1(this._delegate, metadata);\r\n    };\r\n    /**\r\n     * @returns A promise that resolves with the download\r\n     * URL for this object.\r\n     */\r\n    ReferenceCompat.prototype.getDownloadURL = function () {\r\n        return getDownloadURL(this._delegate);\r\n    };\r\n    /**\r\n     * Deletes the object at this location.\r\n     * @returns A promise that resolves if the deletion succeeds.\r\n     */\r\n    ReferenceCompat.prototype.delete = function () {\r\n        this._throwIfRoot('delete');\r\n        return deleteObject$1(this._delegate);\r\n    };\r\n    ReferenceCompat.prototype._throwIfRoot = function (name) {\r\n        if (this._delegate._location.path === '') {\r\n            throw invalidRootOperation(name);\r\n        }\r\n    };\r\n    return ReferenceCompat;\r\n}());\n\n/**\r\n * A request whose promise always fails.\r\n */\r\nvar FailRequest = /** @class */ (function () {\r\n    function FailRequest(error) {\r\n        this.promise_ = Promise.reject(error);\r\n    }\r\n    /** @inheritDoc */\r\n    FailRequest.prototype.getPromise = function () {\r\n        return this.promise_;\r\n    };\r\n    /** @inheritDoc */\r\n    FailRequest.prototype.cancel = function (_appDelete) {\r\n    };\r\n    return FailRequest;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param f May be invoked\r\n *     before the function returns.\r\n * @param callback Get all the arguments passed to the function\r\n *     passed to f, including the initial boolean.\r\n */\r\nfunction start(f, \r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ncallback, timeout) {\r\n    // TODO(andysoto): make this code cleaner (probably refactor into an actual\r\n    // type instead of a bunch of functions with state shared in the closure)\r\n    var waitSeconds = 1;\r\n    // Would type this as \"number\" but that doesn't work for Node so ¯\\_(ツ)_/¯\r\n    // TODO: find a way to exclude Node type definition for storage because storage only works in browser\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    var timeoutId = null;\r\n    var hitTimeout = false;\r\n    var cancelState = 0;\r\n    function canceled() {\r\n        return cancelState === 2;\r\n    }\r\n    var triggeredCallback = false;\r\n    function triggerCallback() {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        if (!triggeredCallback) {\r\n            triggeredCallback = true;\r\n            callback.apply(null, args);\r\n        }\r\n    }\r\n    function callWithDelay(millis) {\r\n        timeoutId = setTimeout(function () {\r\n            timeoutId = null;\r\n            f(handler, canceled());\r\n        }, millis);\r\n    }\r\n    function handler(success) {\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        if (triggeredCallback) {\r\n            return;\r\n        }\r\n        if (success) {\r\n            triggerCallback.call.apply(triggerCallback, __spreadArrays([null, success], args));\r\n            return;\r\n        }\r\n        var mustStop = canceled() || hitTimeout;\r\n        if (mustStop) {\r\n            triggerCallback.call.apply(triggerCallback, __spreadArrays([null, success], args));\r\n            return;\r\n        }\r\n        if (waitSeconds < 64) {\r\n            /* TODO(andysoto): don't back off so quickly if we know we're offline. */\r\n            waitSeconds *= 2;\r\n        }\r\n        var waitMillis;\r\n        if (cancelState === 1) {\r\n            cancelState = 2;\r\n            waitMillis = 0;\r\n        }\r\n        else {\r\n            waitMillis = (waitSeconds + Math.random()) * 1000;\r\n        }\r\n        callWithDelay(waitMillis);\r\n    }\r\n    var stopped = false;\r\n    function stop(wasTimeout) {\r\n        if (stopped) {\r\n            return;\r\n        }\r\n        stopped = true;\r\n        if (triggeredCallback) {\r\n            return;\r\n        }\r\n        if (timeoutId !== null) {\r\n            if (!wasTimeout) {\r\n                cancelState = 2;\r\n            }\r\n            clearTimeout(timeoutId);\r\n            callWithDelay(0);\r\n        }\r\n        else {\r\n            if (!wasTimeout) {\r\n                cancelState = 1;\r\n            }\r\n        }\r\n    }\r\n    callWithDelay(0);\r\n    setTimeout(function () {\r\n        hitTimeout = true;\r\n        stop(true);\r\n    }, timeout);\r\n    return stop;\r\n}\r\n/**\r\n * Stops the retry loop from repeating.\r\n * If the function is currently \"in between\" retries, it is invoked immediately\r\n * with the second parameter as \"true\". Otherwise, it will be invoked once more\r\n * after the current invocation finishes iff the current invocation would have\r\n * triggered another retry.\r\n */\r\nfunction stop(id) {\r\n    id(false);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar NetworkRequest = /** @class */ (function () {\r\n    function NetworkRequest(url, method, headers, body, successCodes, additionalRetryCodes, callback, errorCallback, timeout, progressCallback, pool) {\r\n        var _this = this;\r\n        this.pendingXhr_ = null;\r\n        this.backoffId_ = null;\r\n        this.canceled_ = false;\r\n        this.appDelete_ = false;\r\n        this.url_ = url;\r\n        this.method_ = method;\r\n        this.headers_ = headers;\r\n        this.body_ = body;\r\n        this.successCodes_ = successCodes.slice();\r\n        this.additionalRetryCodes_ = additionalRetryCodes.slice();\r\n        this.callback_ = callback;\r\n        this.errorCallback_ = errorCallback;\r\n        this.progressCallback_ = progressCallback;\r\n        this.timeout_ = timeout;\r\n        this.pool_ = pool;\r\n        this.promise_ = new Promise(function (resolve, reject) {\r\n            _this.resolve_ = resolve;\r\n            _this.reject_ = reject;\r\n            _this.start_();\r\n        });\r\n    }\r\n    /**\r\n     * Actually starts the retry loop.\r\n     */\r\n    NetworkRequest.prototype.start_ = function () {\r\n        var self = this;\r\n        function doTheRequest(backoffCallback, canceled) {\r\n            if (canceled) {\r\n                backoffCallback(false, new RequestEndStatus(false, null, true));\r\n                return;\r\n            }\r\n            var xhr = self.pool_.createXhrIo();\r\n            self.pendingXhr_ = xhr;\r\n            function progressListener(progressEvent) {\r\n                var loaded = progressEvent.loaded;\r\n                var total = progressEvent.lengthComputable ? progressEvent.total : -1;\r\n                if (self.progressCallback_ !== null) {\r\n                    self.progressCallback_(loaded, total);\r\n                }\r\n            }\r\n            if (self.progressCallback_ !== null) {\r\n                xhr.addUploadProgressListener(progressListener);\r\n            }\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            xhr\r\n                .send(self.url_, self.method_, self.body_, self.headers_)\r\n                .then(function (xhr) {\r\n                if (self.progressCallback_ !== null) {\r\n                    xhr.removeUploadProgressListener(progressListener);\r\n                }\r\n                self.pendingXhr_ = null;\r\n                xhr = xhr;\r\n                var hitServer = xhr.getErrorCode() === ErrorCode.NO_ERROR;\r\n                var status = xhr.getStatus();\r\n                if (!hitServer || self.isRetryStatusCode_(status)) {\r\n                    var wasCanceled = xhr.getErrorCode() === ErrorCode.ABORT;\r\n                    backoffCallback(false, new RequestEndStatus(false, null, wasCanceled));\r\n                    return;\r\n                }\r\n                var successCode = self.successCodes_.indexOf(status) !== -1;\r\n                backoffCallback(true, new RequestEndStatus(successCode, xhr));\r\n            });\r\n        }\r\n        /**\r\n         * @param requestWentThrough - True if the request eventually went\r\n         *     through, false if it hit the retry limit or was canceled.\r\n         */\r\n        function backoffDone(requestWentThrough, status) {\r\n            var resolve = self.resolve_;\r\n            var reject = self.reject_;\r\n            var xhr = status.xhr;\r\n            if (status.wasSuccessCode) {\r\n                try {\r\n                    var result = self.callback_(xhr, xhr.getResponseText());\r\n                    if (isJustDef(result)) {\r\n                        resolve(result);\r\n                    }\r\n                    else {\r\n                        resolve();\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    reject(e);\r\n                }\r\n            }\r\n            else {\r\n                if (xhr !== null) {\r\n                    var err = unknown();\r\n                    err.serverResponse = xhr.getResponseText();\r\n                    if (self.errorCallback_) {\r\n                        reject(self.errorCallback_(xhr, err));\r\n                    }\r\n                    else {\r\n                        reject(err);\r\n                    }\r\n                }\r\n                else {\r\n                    if (status.canceled) {\r\n                        var err = self.appDelete_ ? appDeleted() : canceled();\r\n                        reject(err);\r\n                    }\r\n                    else {\r\n                        var err = retryLimitExceeded();\r\n                        reject(err);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (this.canceled_) {\r\n            backoffDone(false, new RequestEndStatus(false, null, true));\r\n        }\r\n        else {\r\n            this.backoffId_ = start(doTheRequest, backoffDone, this.timeout_);\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    NetworkRequest.prototype.getPromise = function () {\r\n        return this.promise_;\r\n    };\r\n    /** @inheritDoc */\r\n    NetworkRequest.prototype.cancel = function (appDelete) {\r\n        this.canceled_ = true;\r\n        this.appDelete_ = appDelete || false;\r\n        if (this.backoffId_ !== null) {\r\n            stop(this.backoffId_);\r\n        }\r\n        if (this.pendingXhr_ !== null) {\r\n            this.pendingXhr_.abort();\r\n        }\r\n    };\r\n    NetworkRequest.prototype.isRetryStatusCode_ = function (status) {\r\n        // The codes for which to retry came from this page:\r\n        // https://cloud.google.com/storage/docs/exponential-backoff\r\n        var isFiveHundredCode = status >= 500 && status < 600;\r\n        var extraRetryCodes = [\r\n            // Request Timeout: web server didn't receive full request in time.\r\n            408,\r\n            // Too Many Requests: you're getting rate-limited, basically.\r\n            429\r\n        ];\r\n        var isExtraRetryCode = extraRetryCodes.indexOf(status) !== -1;\r\n        var isRequestSpecificRetryCode = this.additionalRetryCodes_.indexOf(status) !== -1;\r\n        return isFiveHundredCode || isExtraRetryCode || isRequestSpecificRetryCode;\r\n    };\r\n    return NetworkRequest;\r\n}());\r\n/**\r\n * A collection of information about the result of a network request.\r\n * @param opt_canceled - Defaults to false.\r\n */\r\nvar RequestEndStatus = /** @class */ (function () {\r\n    function RequestEndStatus(wasSuccessCode, xhr, canceled) {\r\n        this.wasSuccessCode = wasSuccessCode;\r\n        this.xhr = xhr;\r\n        this.canceled = !!canceled;\r\n    }\r\n    return RequestEndStatus;\r\n}());\r\nfunction addAuthHeader_(headers, authToken) {\r\n    if (authToken !== null && authToken.length > 0) {\r\n        headers['Authorization'] = 'Firebase ' + authToken;\r\n    }\r\n}\r\nfunction addVersionHeader_(headers) {\r\n    var version = typeof firebase !== 'undefined' ? firebase.SDK_VERSION : 'AppManager';\r\n    headers['X-Firebase-Storage-Version'] = 'webjs/' + version;\r\n}\r\nfunction addGmpidHeader_(headers, appId) {\r\n    if (appId) {\r\n        headers['X-Firebase-GMPID'] = appId;\r\n    }\r\n}\r\nfunction makeRequest(requestInfo, appId, authToken, pool) {\r\n    var queryPart = makeQueryString(requestInfo.urlParams);\r\n    var url = requestInfo.url + queryPart;\r\n    var headers = Object.assign({}, requestInfo.headers);\r\n    addGmpidHeader_(headers, appId);\r\n    addAuthHeader_(headers, authToken);\r\n    addVersionHeader_(headers);\r\n    return new NetworkRequest(url, requestInfo.method, headers, requestInfo.body, requestInfo.successCodes, requestInfo.additionalRetryCodes, requestInfo.handler, requestInfo.errorHandler, requestInfo.timeout, requestInfo.progressCallback, pool);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction isUrl(path) {\r\n    return /^[A-Za-z]+:\\/\\//.test(path);\r\n}\r\n/**\r\n * Returns a firebaseStorage.Reference for the given url.\r\n */\r\nfunction refFromURL(service, url) {\r\n    return new Reference(service, url);\r\n}\r\n/**\r\n * Returns a firebaseStorage.Reference for the given path in the default\r\n * bucket.\r\n */\r\nfunction refFromPath(ref, path) {\r\n    if (ref instanceof StorageService) {\r\n        var service = ref;\r\n        if (service._bucket == null) {\r\n            throw noDefaultBucket();\r\n        }\r\n        var reference = new Reference(service, service._bucket);\r\n        if (path != null) {\r\n            return refFromPath(reference, path);\r\n        }\r\n        else {\r\n            return reference;\r\n        }\r\n    }\r\n    else {\r\n        // ref is a Reference\r\n        if (path !== undefined) {\r\n            if (path.includes('..')) {\r\n                throw invalidArgument('`path` param cannot contain \"..\"');\r\n            }\r\n            return getChild(ref, path);\r\n        }\r\n        else {\r\n            return ref;\r\n        }\r\n    }\r\n}\r\nfunction ref(serviceOrRef, pathOrUrl) {\r\n    if (pathOrUrl && isUrl(pathOrUrl)) {\r\n        if (serviceOrRef instanceof StorageService) {\r\n            return refFromURL(serviceOrRef, pathOrUrl);\r\n        }\r\n        else {\r\n            throw invalidArgument('To use ref(service, url), the first argument must be a Storage instance.');\r\n        }\r\n    }\r\n    else {\r\n        return refFromPath(serviceOrRef, pathOrUrl);\r\n    }\r\n}\r\nfunction extractBucket(config) {\r\n    var bucketString = config === null || config === void 0 ? void 0 : config[CONFIG_STORAGE_BUCKET_KEY];\r\n    if (bucketString == null) {\r\n        return null;\r\n    }\r\n    return Location.makeFromBucketSpec(bucketString);\r\n}\r\n/**\r\n * A service that provides Firebase Storage Reference instances.\r\n * @param opt_url - gs:// url to a custom Storage Bucket\r\n */\r\nvar StorageService = /** @class */ (function () {\r\n    function StorageService(app, \r\n    /**\r\n     * @internal\r\n     */\r\n    _authProvider, \r\n    /**\r\n     * @internal\r\n     */\r\n    _pool, \r\n    /**\r\n     * @internal\r\n     */\r\n    _url) {\r\n        this.app = app;\r\n        this._authProvider = _authProvider;\r\n        this._pool = _pool;\r\n        this._url = _url;\r\n        /**\r\n         * @internal\r\n         */\r\n        this._bucket = null;\r\n        this._appId = null;\r\n        this._deleted = false;\r\n        this._maxOperationRetryTime = DEFAULT_MAX_OPERATION_RETRY_TIME;\r\n        this._maxUploadRetryTime = DEFAULT_MAX_UPLOAD_RETRY_TIME;\r\n        this._requests = new Set();\r\n        if (_url != null) {\r\n            this._bucket = Location.makeFromBucketSpec(_url);\r\n        }\r\n        else {\r\n            this._bucket = extractBucket(this.app.options);\r\n        }\r\n    }\r\n    Object.defineProperty(StorageService.prototype, \"maxUploadRetryTime\", {\r\n        get: function () {\r\n            return this._maxUploadRetryTime;\r\n        },\r\n        set: function (time) {\r\n            validateNumber('time', \r\n            /* minValue=*/ 0, \r\n            /* maxValue= */ Number.POSITIVE_INFINITY, time);\r\n            this._maxUploadRetryTime = time;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(StorageService.prototype, \"maxOperationRetryTime\", {\r\n        get: function () {\r\n            return this._maxOperationRetryTime;\r\n        },\r\n        set: function (time) {\r\n            validateNumber('time', \r\n            /* minValue=*/ 0, \r\n            /* maxValue= */ Number.POSITIVE_INFINITY, time);\r\n            this._maxOperationRetryTime = time;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    StorageService.prototype.getAuthToken = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var auth, tokenData;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        auth = this._authProvider.getImmediate({ optional: true });\r\n                        if (!auth) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, auth.getToken()];\r\n                    case 1:\r\n                        tokenData = _a.sent();\r\n                        if (tokenData !== null) {\r\n                            return [2 /*return*/, tokenData.accessToken];\r\n                        }\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/, null];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Stop running requests and prevent more from being created.\r\n     * @internal\r\n     */\r\n    StorageService.prototype._delete = function () {\r\n        this._deleted = true;\r\n        this._requests.forEach(function (request) { return request.cancel(); });\r\n        this._requests.clear();\r\n        return Promise.resolve();\r\n    };\r\n    /**\r\n     * Returns a new firebaseStorage.Reference object referencing this StorageService\r\n     * at the given Location.\r\n     */\r\n    StorageService.prototype.makeStorageReference = function (loc) {\r\n        return new Reference(this, loc);\r\n    };\r\n    /**\r\n     * @internal\r\n     * @param requestInfo - HTTP RequestInfo object\r\n     * @param authToken - Firebase auth token\r\n     */\r\n    StorageService.prototype.makeRequest = function (requestInfo, authToken) {\r\n        var _this = this;\r\n        if (!this._deleted) {\r\n            var request_1 = makeRequest(requestInfo, this._appId, authToken, this._pool);\r\n            this._requests.add(request_1);\r\n            // Request removes itself from set when complete.\r\n            request_1.getPromise().then(function () { return _this._requests.delete(request_1); }, function () { return _this._requests.delete(request_1); });\r\n            return request_1;\r\n        }\r\n        else {\r\n            return new FailRequest(appDeleted());\r\n        }\r\n    };\r\n    return StorageService;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A service that provides firebaseStorage.Reference instances.\r\n * @param opt_url gs:// url to a custom Storage Bucket\r\n */\r\nvar StorageServiceCompat = /** @class */ (function () {\r\n    function StorageServiceCompat(app, _delegate) {\r\n        var _this = this;\r\n        this.app = app;\r\n        this._delegate = _delegate;\r\n        this.INTERNAL = {\r\n            /**\r\n             * Called when the associated app is deleted.\r\n             */\r\n            delete: function () {\r\n                return _this._delegate._delete();\r\n            }\r\n        };\r\n    }\r\n    Object.defineProperty(StorageServiceCompat.prototype, \"maxOperationRetryTime\", {\r\n        get: function () {\r\n            return this._delegate.maxOperationRetryTime;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(StorageServiceCompat.prototype, \"maxUploadRetryTime\", {\r\n        get: function () {\r\n            return this._delegate.maxUploadRetryTime;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Returns a firebaseStorage.Reference for the given path in the default\r\n     * bucket.\r\n     */\r\n    StorageServiceCompat.prototype.ref = function (path) {\r\n        if (isUrl(path)) {\r\n            throw invalidArgument('ref() expected a child path but got a URL, use refFromURL instead.');\r\n        }\r\n        return new ReferenceCompat(ref(this._delegate, path), this);\r\n    };\r\n    /**\r\n     * Returns a firebaseStorage.Reference object for the given absolute URL,\r\n     * which must be a gs:// or http[s]:// URL.\r\n     */\r\n    StorageServiceCompat.prototype.refFromURL = function (url) {\r\n        if (!isUrl(url)) {\r\n            throw invalidArgument('refFromURL() expected a full URL but got a child path, use ref() instead.');\r\n        }\r\n        try {\r\n            Location.makeFromUrl(url);\r\n        }\r\n        catch (e) {\r\n            throw invalidArgument('refFromUrl() expected a valid full URL but got an invalid one.');\r\n        }\r\n        return new ReferenceCompat(ref(this._delegate, url), this);\r\n    };\r\n    StorageServiceCompat.prototype.setMaxUploadRetryTime = function (time) {\r\n        this._delegate.maxUploadRetryTime = time;\r\n    };\r\n    StorageServiceCompat.prototype.setMaxOperationRetryTime = function (time) {\r\n        this._delegate.maxOperationRetryTime = time;\r\n    };\r\n    return StorageServiceCompat;\r\n}());\n\nvar name = \"@firebase/storage\";\nvar version = \"0.4.2\";\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Type constant for Firebase Storage.\r\n */\r\nvar STORAGE_TYPE = 'storage';\r\nfunction factory(container, url) {\r\n    // Dependencies\r\n    // TODO: This should eventually be 'app-compat'\r\n    var app = container.getProvider('app').getImmediate();\r\n    var authProvider = container.getProvider('auth-internal');\r\n    // TODO: get StorageService instance from component framework instead\r\n    // of creating a new one.\r\n    var storageServiceCompat = new StorageServiceCompat(app, new StorageService(app, authProvider, new XhrIoPool(), url));\r\n    return storageServiceCompat;\r\n}\r\nfunction registerStorage(instance) {\r\n    var namespaceExports = {\r\n        // no-inline\r\n        TaskState: TaskState,\r\n        TaskEvent: TaskEvent,\r\n        StringFormat: StringFormat,\r\n        Storage: StorageService,\r\n        Reference: ReferenceCompat\r\n    };\r\n    instance.INTERNAL.registerComponent(new Component(STORAGE_TYPE, factory, \"PUBLIC\" /* PUBLIC */)\r\n        .setServiceProps(namespaceExports)\r\n        .setMultipleInstances(true));\r\n    instance.registerVersion(name, version);\r\n}\r\nregisterStorage(firebase);\n\nexport { registerStorage };\n//# sourceMappingURL=index.esm.js.map\n","import { __extends } from 'tslib';\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Firebase constants.  Some of these (@defines) can be overridden at compile-time.\r\n */\r\nvar CONSTANTS = {\r\n    /**\r\n     * @define {boolean} Whether this is the client Node.js SDK.\r\n     */\r\n    NODE_CLIENT: false,\r\n    /**\r\n     * @define {boolean} Whether this is the Admin Node.js SDK.\r\n     */\r\n    NODE_ADMIN: false,\r\n    /**\r\n     * Firebase SDK Version\r\n     */\r\n    SDK_VERSION: '${JSCORE_VERSION}'\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Throws an error if the provided assertion is falsy\r\n */\r\nvar assert = function (assertion, message) {\r\n    if (!assertion) {\r\n        throw assertionError(message);\r\n    }\r\n};\r\n/**\r\n * Returns an Error object suitable for throwing.\r\n */\r\nvar assertionError = function (message) {\r\n    return new Error('Firebase Database (' +\r\n        CONSTANTS.SDK_VERSION +\r\n        ') INTERNAL ASSERT FAILED: ' +\r\n        message);\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar stringToByteArray = function (str) {\r\n    // TODO(user): Use native implementations if/when available\r\n    var out = [];\r\n    var p = 0;\r\n    for (var i = 0; i < str.length; i++) {\r\n        var c = str.charCodeAt(i);\r\n        if (c < 128) {\r\n            out[p++] = c;\r\n        }\r\n        else if (c < 2048) {\r\n            out[p++] = (c >> 6) | 192;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else if ((c & 0xfc00) === 0xd800 &&\r\n            i + 1 < str.length &&\r\n            (str.charCodeAt(i + 1) & 0xfc00) === 0xdc00) {\r\n            // Surrogate Pair\r\n            c = 0x10000 + ((c & 0x03ff) << 10) + (str.charCodeAt(++i) & 0x03ff);\r\n            out[p++] = (c >> 18) | 240;\r\n            out[p++] = ((c >> 12) & 63) | 128;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else {\r\n            out[p++] = (c >> 12) | 224;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n    }\r\n    return out;\r\n};\r\n/**\r\n * Turns an array of numbers into the string given by the concatenation of the\r\n * characters to which the numbers correspond.\r\n * @param bytes Array of numbers representing characters.\r\n * @return Stringification of the array.\r\n */\r\nvar byteArrayToString = function (bytes) {\r\n    // TODO(user): Use native implementations if/when available\r\n    var out = [];\r\n    var pos = 0, c = 0;\r\n    while (pos < bytes.length) {\r\n        var c1 = bytes[pos++];\r\n        if (c1 < 128) {\r\n            out[c++] = String.fromCharCode(c1);\r\n        }\r\n        else if (c1 > 191 && c1 < 224) {\r\n            var c2 = bytes[pos++];\r\n            out[c++] = String.fromCharCode(((c1 & 31) << 6) | (c2 & 63));\r\n        }\r\n        else if (c1 > 239 && c1 < 365) {\r\n            // Surrogate Pair\r\n            var c2 = bytes[pos++];\r\n            var c3 = bytes[pos++];\r\n            var c4 = bytes[pos++];\r\n            var u = (((c1 & 7) << 18) | ((c2 & 63) << 12) | ((c3 & 63) << 6) | (c4 & 63)) -\r\n                0x10000;\r\n            out[c++] = String.fromCharCode(0xd800 + (u >> 10));\r\n            out[c++] = String.fromCharCode(0xdc00 + (u & 1023));\r\n        }\r\n        else {\r\n            var c2 = bytes[pos++];\r\n            var c3 = bytes[pos++];\r\n            out[c++] = String.fromCharCode(((c1 & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\r\n        }\r\n    }\r\n    return out.join('');\r\n};\r\n// We define it as an object literal instead of a class because a class compiled down to es5 can't\r\n// be treeshaked. https://github.com/rollup/rollup/issues/1691\r\n// Static lookup maps, lazily populated by init_()\r\nvar base64 = {\r\n    /**\r\n     * Maps bytes to characters.\r\n     */\r\n    byteToCharMap_: null,\r\n    /**\r\n     * Maps characters to bytes.\r\n     */\r\n    charToByteMap_: null,\r\n    /**\r\n     * Maps bytes to websafe characters.\r\n     * @private\r\n     */\r\n    byteToCharMapWebSafe_: null,\r\n    /**\r\n     * Maps websafe characters to bytes.\r\n     * @private\r\n     */\r\n    charToByteMapWebSafe_: null,\r\n    /**\r\n     * Our default alphabet, shared between\r\n     * ENCODED_VALS and ENCODED_VALS_WEBSAFE\r\n     */\r\n    ENCODED_VALS_BASE: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' + 'abcdefghijklmnopqrstuvwxyz' + '0123456789',\r\n    /**\r\n     * Our default alphabet. Value 64 (=) is special; it means \"nothing.\"\r\n     */\r\n    get ENCODED_VALS() {\r\n        return this.ENCODED_VALS_BASE + '+/=';\r\n    },\r\n    /**\r\n     * Our websafe alphabet.\r\n     */\r\n    get ENCODED_VALS_WEBSAFE() {\r\n        return this.ENCODED_VALS_BASE + '-_.';\r\n    },\r\n    /**\r\n     * Whether this browser supports the atob and btoa functions. This extension\r\n     * started at Mozilla but is now implemented by many browsers. We use the\r\n     * ASSUME_* variables to avoid pulling in the full useragent detection library\r\n     * but still allowing the standard per-browser compilations.\r\n     *\r\n     */\r\n    HAS_NATIVE_SUPPORT: typeof atob === 'function',\r\n    /**\r\n     * Base64-encode an array of bytes.\r\n     *\r\n     * @param input An array of bytes (numbers with\r\n     *     value in [0, 255]) to encode.\r\n     * @param webSafe Boolean indicating we should use the\r\n     *     alternative alphabet.\r\n     * @return The base64 encoded string.\r\n     */\r\n    encodeByteArray: function (input, webSafe) {\r\n        if (!Array.isArray(input)) {\r\n            throw Error('encodeByteArray takes an array as a parameter');\r\n        }\r\n        this.init_();\r\n        var byteToCharMap = webSafe\r\n            ? this.byteToCharMapWebSafe_\r\n            : this.byteToCharMap_;\r\n        var output = [];\r\n        for (var i = 0; i < input.length; i += 3) {\r\n            var byte1 = input[i];\r\n            var haveByte2 = i + 1 < input.length;\r\n            var byte2 = haveByte2 ? input[i + 1] : 0;\r\n            var haveByte3 = i + 2 < input.length;\r\n            var byte3 = haveByte3 ? input[i + 2] : 0;\r\n            var outByte1 = byte1 >> 2;\r\n            var outByte2 = ((byte1 & 0x03) << 4) | (byte2 >> 4);\r\n            var outByte3 = ((byte2 & 0x0f) << 2) | (byte3 >> 6);\r\n            var outByte4 = byte3 & 0x3f;\r\n            if (!haveByte3) {\r\n                outByte4 = 64;\r\n                if (!haveByte2) {\r\n                    outByte3 = 64;\r\n                }\r\n            }\r\n            output.push(byteToCharMap[outByte1], byteToCharMap[outByte2], byteToCharMap[outByte3], byteToCharMap[outByte4]);\r\n        }\r\n        return output.join('');\r\n    },\r\n    /**\r\n     * Base64-encode a string.\r\n     *\r\n     * @param input A string to encode.\r\n     * @param webSafe If true, we should use the\r\n     *     alternative alphabet.\r\n     * @return The base64 encoded string.\r\n     */\r\n    encodeString: function (input, webSafe) {\r\n        // Shortcut for Mozilla browsers that implement\r\n        // a native base64 encoder in the form of \"btoa/atob\"\r\n        if (this.HAS_NATIVE_SUPPORT && !webSafe) {\r\n            return btoa(input);\r\n        }\r\n        return this.encodeByteArray(stringToByteArray(input), webSafe);\r\n    },\r\n    /**\r\n     * Base64-decode a string.\r\n     *\r\n     * @param input to decode.\r\n     * @param webSafe True if we should use the\r\n     *     alternative alphabet.\r\n     * @return string representing the decoded value.\r\n     */\r\n    decodeString: function (input, webSafe) {\r\n        // Shortcut for Mozilla browsers that implement\r\n        // a native base64 encoder in the form of \"btoa/atob\"\r\n        if (this.HAS_NATIVE_SUPPORT && !webSafe) {\r\n            return atob(input);\r\n        }\r\n        return byteArrayToString(this.decodeStringToByteArray(input, webSafe));\r\n    },\r\n    /**\r\n     * Base64-decode a string.\r\n     *\r\n     * In base-64 decoding, groups of four characters are converted into three\r\n     * bytes.  If the encoder did not apply padding, the input length may not\r\n     * be a multiple of 4.\r\n     *\r\n     * In this case, the last group will have fewer than 4 characters, and\r\n     * padding will be inferred.  If the group has one or two characters, it decodes\r\n     * to one byte.  If the group has three characters, it decodes to two bytes.\r\n     *\r\n     * @param input Input to decode.\r\n     * @param webSafe True if we should use the web-safe alphabet.\r\n     * @return bytes representing the decoded value.\r\n     */\r\n    decodeStringToByteArray: function (input, webSafe) {\r\n        this.init_();\r\n        var charToByteMap = webSafe\r\n            ? this.charToByteMapWebSafe_\r\n            : this.charToByteMap_;\r\n        var output = [];\r\n        for (var i = 0; i < input.length;) {\r\n            var byte1 = charToByteMap[input.charAt(i++)];\r\n            var haveByte2 = i < input.length;\r\n            var byte2 = haveByte2 ? charToByteMap[input.charAt(i)] : 0;\r\n            ++i;\r\n            var haveByte3 = i < input.length;\r\n            var byte3 = haveByte3 ? charToByteMap[input.charAt(i)] : 64;\r\n            ++i;\r\n            var haveByte4 = i < input.length;\r\n            var byte4 = haveByte4 ? charToByteMap[input.charAt(i)] : 64;\r\n            ++i;\r\n            if (byte1 == null || byte2 == null || byte3 == null || byte4 == null) {\r\n                throw Error();\r\n            }\r\n            var outByte1 = (byte1 << 2) | (byte2 >> 4);\r\n            output.push(outByte1);\r\n            if (byte3 !== 64) {\r\n                var outByte2 = ((byte2 << 4) & 0xf0) | (byte3 >> 2);\r\n                output.push(outByte2);\r\n                if (byte4 !== 64) {\r\n                    var outByte3 = ((byte3 << 6) & 0xc0) | byte4;\r\n                    output.push(outByte3);\r\n                }\r\n            }\r\n        }\r\n        return output;\r\n    },\r\n    /**\r\n     * Lazy static initialization function. Called before\r\n     * accessing any of the static map variables.\r\n     * @private\r\n     */\r\n    init_: function () {\r\n        if (!this.byteToCharMap_) {\r\n            this.byteToCharMap_ = {};\r\n            this.charToByteMap_ = {};\r\n            this.byteToCharMapWebSafe_ = {};\r\n            this.charToByteMapWebSafe_ = {};\r\n            // We want quick mappings back and forth, so we precompute two maps.\r\n            for (var i = 0; i < this.ENCODED_VALS.length; i++) {\r\n                this.byteToCharMap_[i] = this.ENCODED_VALS.charAt(i);\r\n                this.charToByteMap_[this.byteToCharMap_[i]] = i;\r\n                this.byteToCharMapWebSafe_[i] = this.ENCODED_VALS_WEBSAFE.charAt(i);\r\n                this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]] = i;\r\n                // Be forgiving when decoding and correctly decode both encodings.\r\n                if (i >= this.ENCODED_VALS_BASE.length) {\r\n                    this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)] = i;\r\n                    this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)] = i;\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n/**\r\n * URL-safe base64 encoding\r\n */\r\nvar base64Encode = function (str) {\r\n    var utf8Bytes = stringToByteArray(str);\r\n    return base64.encodeByteArray(utf8Bytes, true);\r\n};\r\n/**\r\n * URL-safe base64 decoding\r\n *\r\n * NOTE: DO NOT use the global atob() function - it does NOT support the\r\n * base64Url variant encoding.\r\n *\r\n * @param str To be decoded\r\n * @return Decoded result, if possible\r\n */\r\nvar base64Decode = function (str) {\r\n    try {\r\n        return base64.decodeString(str, true);\r\n    }\r\n    catch (e) {\r\n        console.error('base64Decode failed: ', e);\r\n    }\r\n    return null;\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Do a deep-copy of basic JavaScript Objects or Arrays.\r\n */\r\nfunction deepCopy(value) {\r\n    return deepExtend(undefined, value);\r\n}\r\n/**\r\n * Copy properties from source to target (recursively allows extension\r\n * of Objects and Arrays).  Scalar values in the target are over-written.\r\n * If target is undefined, an object of the appropriate type will be created\r\n * (and returned).\r\n *\r\n * We recursively copy all child properties of plain Objects in the source- so\r\n * that namespace- like dictionaries are merged.\r\n *\r\n * Note that the target can be a function, in which case the properties in\r\n * the source Object are copied onto it as static properties of the Function.\r\n *\r\n * Note: we don't merge __proto__ to prevent prototype pollution\r\n */\r\nfunction deepExtend(target, source) {\r\n    if (!(source instanceof Object)) {\r\n        return source;\r\n    }\r\n    switch (source.constructor) {\r\n        case Date:\r\n            // Treat Dates like scalars; if the target date object had any child\r\n            // properties - they will be lost!\r\n            var dateValue = source;\r\n            return new Date(dateValue.getTime());\r\n        case Object:\r\n            if (target === undefined) {\r\n                target = {};\r\n            }\r\n            break;\r\n        case Array:\r\n            // Always copy the array source and overwrite the target.\r\n            target = [];\r\n            break;\r\n        default:\r\n            // Not a plain Object - treat it as a scalar.\r\n            return source;\r\n    }\r\n    for (var prop in source) {\r\n        // use isValidKey to guard against prototype pollution. See https://snyk.io/vuln/SNYK-JS-LODASH-450202\r\n        if (!source.hasOwnProperty(prop) || !isValidKey(prop)) {\r\n            continue;\r\n        }\r\n        target[prop] = deepExtend(target[prop], source[prop]);\r\n    }\r\n    return target;\r\n}\r\nfunction isValidKey(key) {\r\n    return key !== '__proto__';\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar Deferred = /** @class */ (function () {\r\n    function Deferred() {\r\n        var _this = this;\r\n        this.reject = function () { };\r\n        this.resolve = function () { };\r\n        this.promise = new Promise(function (resolve, reject) {\r\n            _this.resolve = resolve;\r\n            _this.reject = reject;\r\n        });\r\n    }\r\n    /**\r\n     * Our API internals are not promiseified and cannot because our callback APIs have subtle expectations around\r\n     * invoking promises inline, which Promises are forbidden to do. This method accepts an optional node-style callback\r\n     * and returns a node-style callback which will resolve or reject the Deferred's promise.\r\n     */\r\n    Deferred.prototype.wrapCallback = function (callback) {\r\n        var _this = this;\r\n        return function (error, value) {\r\n            if (error) {\r\n                _this.reject(error);\r\n            }\r\n            else {\r\n                _this.resolve(value);\r\n            }\r\n            if (typeof callback === 'function') {\r\n                // Attaching noop handler just in case developer wasn't expecting\r\n                // promises\r\n                _this.promise.catch(function () { });\r\n                // Some of our callbacks don't expect a value and our own tests\r\n                // assert that the parameter length is 1\r\n                if (callback.length === 1) {\r\n                    callback(error);\r\n                }\r\n                else {\r\n                    callback(error, value);\r\n                }\r\n            }\r\n        };\r\n    };\r\n    return Deferred;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns navigator.userAgent string or '' if it's not defined.\r\n * @return user agent string\r\n */\r\nfunction getUA() {\r\n    if (typeof navigator !== 'undefined' &&\r\n        typeof navigator['userAgent'] === 'string') {\r\n        return navigator['userAgent'];\r\n    }\r\n    else {\r\n        return '';\r\n    }\r\n}\r\n/**\r\n * Detect Cordova / PhoneGap / Ionic frameworks on a mobile device.\r\n *\r\n * Deliberately does not rely on checking `file://` URLs (as this fails PhoneGap\r\n * in the Ripple emulator) nor Cordova `onDeviceReady`, which would normally\r\n * wait for a callback.\r\n */\r\nfunction isMobileCordova() {\r\n    return (typeof window !== 'undefined' &&\r\n        // @ts-ignore Setting up an broadly applicable index signature for Window\r\n        // just to deal with this case would probably be a bad idea.\r\n        !!(window['cordova'] || window['phonegap'] || window['PhoneGap']) &&\r\n        /ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA()));\r\n}\r\n/**\r\n * Detect Node.js.\r\n *\r\n * @return true if Node.js environment is detected.\r\n */\r\n// Node detection logic from: https://github.com/iliakan/detect-node/\r\nfunction isNode() {\r\n    try {\r\n        return (Object.prototype.toString.call(global.process) === '[object process]');\r\n    }\r\n    catch (e) {\r\n        return false;\r\n    }\r\n}\r\n/**\r\n * Detect Browser Environment\r\n */\r\nfunction isBrowser() {\r\n    return typeof self === 'object' && self.self === self;\r\n}\r\nfunction isBrowserExtension() {\r\n    var runtime = typeof chrome === 'object'\r\n        ? chrome.runtime\r\n        : typeof browser === 'object'\r\n            ? browser.runtime\r\n            : undefined;\r\n    return typeof runtime === 'object' && runtime.id !== undefined;\r\n}\r\n/**\r\n * Detect React Native.\r\n *\r\n * @return true if ReactNative environment is detected.\r\n */\r\nfunction isReactNative() {\r\n    return (typeof navigator === 'object' && navigator['product'] === 'ReactNative');\r\n}\r\n/** Detects Electron apps. */\r\nfunction isElectron() {\r\n    return getUA().indexOf('Electron/') >= 0;\r\n}\r\n/** Detects Internet Explorer. */\r\nfunction isIE() {\r\n    var ua = getUA();\r\n    return ua.indexOf('MSIE ') >= 0 || ua.indexOf('Trident/') >= 0;\r\n}\r\n/** Detects Universal Windows Platform apps. */\r\nfunction isUWP() {\r\n    return getUA().indexOf('MSAppHost/') >= 0;\r\n}\r\n/**\r\n * Detect whether the current SDK build is the Node version.\r\n *\r\n * @return true if it's the Node SDK build.\r\n */\r\nfunction isNodeSdk() {\r\n    return CONSTANTS.NODE_CLIENT === true || CONSTANTS.NODE_ADMIN === true;\r\n}\r\n/** Returns true if we are running in Safari. */\r\nfunction isSafari() {\r\n    return (!isNode() &&\r\n        navigator.userAgent.includes('Safari') &&\r\n        !navigator.userAgent.includes('Chrome'));\r\n}\r\n/**\r\n * This method checks if indexedDB is supported by current browser/service worker context\r\n * @return true if indexedDB is supported by current browser/service worker context\r\n */\r\nfunction isIndexedDBAvailable() {\r\n    return 'indexedDB' in self && indexedDB != null;\r\n}\r\n/**\r\n * This method validates browser context for indexedDB by opening a dummy indexedDB database and reject\r\n * if errors occur during the database open operation.\r\n */\r\nfunction validateIndexedDBOpenable() {\r\n    return new Promise(function (resolve, reject) {\r\n        try {\r\n            var preExist_1 = true;\r\n            var DB_CHECK_NAME_1 = 'validate-browser-context-for-indexeddb-analytics-module';\r\n            var request_1 = window.indexedDB.open(DB_CHECK_NAME_1);\r\n            request_1.onsuccess = function () {\r\n                request_1.result.close();\r\n                // delete database only when it doesn't pre-exist\r\n                if (!preExist_1) {\r\n                    window.indexedDB.deleteDatabase(DB_CHECK_NAME_1);\r\n                }\r\n                resolve(true);\r\n            };\r\n            request_1.onupgradeneeded = function () {\r\n                preExist_1 = false;\r\n            };\r\n            request_1.onerror = function () {\r\n                var _a;\r\n                reject(((_a = request_1.error) === null || _a === void 0 ? void 0 : _a.message) || '');\r\n            };\r\n        }\r\n        catch (error) {\r\n            reject(error);\r\n        }\r\n    });\r\n}\r\n/**\r\n *\r\n * This method checks whether cookie is enabled within current browser\r\n * @return true if cookie is enabled within current browser\r\n */\r\nfunction areCookiesEnabled() {\r\n    if (!navigator || !navigator.cookieEnabled) {\r\n        return false;\r\n    }\r\n    return true;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar ERROR_NAME = 'FirebaseError';\r\n// Based on code from:\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Custom_Error_Types\r\nvar FirebaseError = /** @class */ (function (_super) {\r\n    __extends(FirebaseError, _super);\r\n    function FirebaseError(code, message, customData) {\r\n        var _this = _super.call(this, message) || this;\r\n        _this.code = code;\r\n        _this.customData = customData;\r\n        _this.name = ERROR_NAME;\r\n        // Fix For ES5\r\n        // https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\r\n        Object.setPrototypeOf(_this, FirebaseError.prototype);\r\n        // Maintains proper stack trace for where our error was thrown.\r\n        // Only available on V8.\r\n        if (Error.captureStackTrace) {\r\n            Error.captureStackTrace(_this, ErrorFactory.prototype.create);\r\n        }\r\n        return _this;\r\n    }\r\n    return FirebaseError;\r\n}(Error));\r\nvar ErrorFactory = /** @class */ (function () {\r\n    function ErrorFactory(service, serviceName, errors) {\r\n        this.service = service;\r\n        this.serviceName = serviceName;\r\n        this.errors = errors;\r\n    }\r\n    ErrorFactory.prototype.create = function (code) {\r\n        var data = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            data[_i - 1] = arguments[_i];\r\n        }\r\n        var customData = data[0] || {};\r\n        var fullCode = this.service + \"/\" + code;\r\n        var template = this.errors[code];\r\n        var message = template ? replaceTemplate(template, customData) : 'Error';\r\n        // Service Name: Error message (service/code).\r\n        var fullMessage = this.serviceName + \": \" + message + \" (\" + fullCode + \").\";\r\n        var error = new FirebaseError(fullCode, fullMessage, customData);\r\n        return error;\r\n    };\r\n    return ErrorFactory;\r\n}());\r\nfunction replaceTemplate(template, data) {\r\n    return template.replace(PATTERN, function (_, key) {\r\n        var value = data[key];\r\n        return value != null ? String(value) : \"<\" + key + \"?>\";\r\n    });\r\n}\r\nvar PATTERN = /\\{\\$([^}]+)}/g;\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Evaluates a JSON string into a javascript object.\r\n *\r\n * @param {string} str A string containing JSON.\r\n * @return {*} The javascript object representing the specified JSON.\r\n */\r\nfunction jsonEval(str) {\r\n    return JSON.parse(str);\r\n}\r\n/**\r\n * Returns JSON representing a javascript object.\r\n * @param {*} data Javascript object to be stringified.\r\n * @return {string} The JSON contents of the object.\r\n */\r\nfunction stringify(data) {\r\n    return JSON.stringify(data);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Decodes a Firebase auth. token into constituent parts.\r\n *\r\n * Notes:\r\n * - May return with invalid / incomplete claims if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nvar decode = function (token) {\r\n    var header = {}, claims = {}, data = {}, signature = '';\r\n    try {\r\n        var parts = token.split('.');\r\n        header = jsonEval(base64Decode(parts[0]) || '');\r\n        claims = jsonEval(base64Decode(parts[1]) || '');\r\n        signature = parts[2];\r\n        data = claims['d'] || {};\r\n        delete claims['d'];\r\n    }\r\n    catch (e) { }\r\n    return {\r\n        header: header,\r\n        claims: claims,\r\n        data: data,\r\n        signature: signature\r\n    };\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and checks the validity of its time-based claims. Will return true if the\r\n * token is within the time window authorized by the 'nbf' (not-before) and 'iat' (issued-at) claims.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nvar isValidTimestamp = function (token) {\r\n    var claims = decode(token).claims;\r\n    var now = Math.floor(new Date().getTime() / 1000);\r\n    var validSince = 0, validUntil = 0;\r\n    if (typeof claims === 'object') {\r\n        if (claims.hasOwnProperty('nbf')) {\r\n            validSince = claims['nbf'];\r\n        }\r\n        else if (claims.hasOwnProperty('iat')) {\r\n            validSince = claims['iat'];\r\n        }\r\n        if (claims.hasOwnProperty('exp')) {\r\n            validUntil = claims['exp'];\r\n        }\r\n        else {\r\n            // token will expire after 24h by default\r\n            validUntil = validSince + 86400;\r\n        }\r\n    }\r\n    return (!!now &&\r\n        !!validSince &&\r\n        !!validUntil &&\r\n        now >= validSince &&\r\n        now <= validUntil);\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and returns its issued at time if valid, null otherwise.\r\n *\r\n * Notes:\r\n * - May return null if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nvar issuedAtTime = function (token) {\r\n    var claims = decode(token).claims;\r\n    if (typeof claims === 'object' && claims.hasOwnProperty('iat')) {\r\n        return claims['iat'];\r\n    }\r\n    return null;\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and checks the validity of its format. Expects a valid issued-at time.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nvar isValidFormat = function (token) {\r\n    var decoded = decode(token), claims = decoded.claims;\r\n    return !!claims && typeof claims === 'object' && claims.hasOwnProperty('iat');\r\n};\r\n/**\r\n * Attempts to peer into an auth token and determine if it's an admin auth token by looking at the claims portion.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nvar isAdmin = function (token) {\r\n    var claims = decode(token).claims;\r\n    return typeof claims === 'object' && claims['admin'] === true;\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction contains(obj, key) {\r\n    return Object.prototype.hasOwnProperty.call(obj, key);\r\n}\r\nfunction safeGet(obj, key) {\r\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n        return obj[key];\r\n    }\r\n    else {\r\n        return undefined;\r\n    }\r\n}\r\nfunction isEmpty(obj) {\r\n    for (var key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nfunction map(obj, fn, contextObj) {\r\n    var res = {};\r\n    for (var key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            res[key] = fn.call(contextObj, obj[key], key, obj);\r\n        }\r\n    }\r\n    return res;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a querystring-formatted string (e.g. &arg=val&arg2=val2) from a\r\n * params object (e.g. {arg: 'val', arg2: 'val2'})\r\n * Note: You must prepend it with ? when adding it to a URL.\r\n */\r\nfunction querystring(querystringParams) {\r\n    var params = [];\r\n    var _loop_1 = function (key, value) {\r\n        if (Array.isArray(value)) {\r\n            value.forEach(function (arrayVal) {\r\n                params.push(encodeURIComponent(key) + '=' + encodeURIComponent(arrayVal));\r\n            });\r\n        }\r\n        else {\r\n            params.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));\r\n        }\r\n    };\r\n    for (var _i = 0, _a = Object.entries(querystringParams); _i < _a.length; _i++) {\r\n        var _b = _a[_i], key = _b[0], value = _b[1];\r\n        _loop_1(key, value);\r\n    }\r\n    return params.length ? '&' + params.join('&') : '';\r\n}\r\n/**\r\n * Decodes a querystring (e.g. ?arg=val&arg2=val2) into a params object\r\n * (e.g. {arg: 'val', arg2: 'val2'})\r\n */\r\nfunction querystringDecode(querystring) {\r\n    var obj = {};\r\n    var tokens = querystring.replace(/^\\?/, '').split('&');\r\n    tokens.forEach(function (token) {\r\n        if (token) {\r\n            var key = token.split('=');\r\n            obj[key[0]] = key[1];\r\n        }\r\n    });\r\n    return obj;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview SHA-1 cryptographic hash.\r\n * Variable names follow the notation in FIPS PUB 180-3:\r\n * http://csrc.nist.gov/publications/fips/fips180-3/fips180-3_final.pdf.\r\n *\r\n * Usage:\r\n *   var sha1 = new sha1();\r\n *   sha1.update(bytes);\r\n *   var hash = sha1.digest();\r\n *\r\n * Performance:\r\n *   Chrome 23:   ~400 Mbit/s\r\n *   Firefox 16:  ~250 Mbit/s\r\n *\r\n */\r\n/**\r\n * SHA-1 cryptographic hash constructor.\r\n *\r\n * The properties declared here are discussed in the above algorithm document.\r\n * @constructor\r\n * @final\r\n * @struct\r\n */\r\nvar Sha1 = /** @class */ (function () {\r\n    function Sha1() {\r\n        /**\r\n         * Holds the previous values of accumulated variables a-e in the compress_\r\n         * function.\r\n         * @private\r\n         */\r\n        this.chain_ = [];\r\n        /**\r\n         * A buffer holding the partially computed hash result.\r\n         * @private\r\n         */\r\n        this.buf_ = [];\r\n        /**\r\n         * An array of 80 bytes, each a part of the message to be hashed.  Referred to\r\n         * as the message schedule in the docs.\r\n         * @private\r\n         */\r\n        this.W_ = [];\r\n        /**\r\n         * Contains data needed to pad messages less than 64 bytes.\r\n         * @private\r\n         */\r\n        this.pad_ = [];\r\n        /**\r\n         * @private {number}\r\n         */\r\n        this.inbuf_ = 0;\r\n        /**\r\n         * @private {number}\r\n         */\r\n        this.total_ = 0;\r\n        this.blockSize = 512 / 8;\r\n        this.pad_[0] = 128;\r\n        for (var i = 1; i < this.blockSize; ++i) {\r\n            this.pad_[i] = 0;\r\n        }\r\n        this.reset();\r\n    }\r\n    Sha1.prototype.reset = function () {\r\n        this.chain_[0] = 0x67452301;\r\n        this.chain_[1] = 0xefcdab89;\r\n        this.chain_[2] = 0x98badcfe;\r\n        this.chain_[3] = 0x10325476;\r\n        this.chain_[4] = 0xc3d2e1f0;\r\n        this.inbuf_ = 0;\r\n        this.total_ = 0;\r\n    };\r\n    /**\r\n     * Internal compress helper function.\r\n     * @param buf Block to compress.\r\n     * @param offset Offset of the block in the buffer.\r\n     * @private\r\n     */\r\n    Sha1.prototype.compress_ = function (buf, offset) {\r\n        if (!offset) {\r\n            offset = 0;\r\n        }\r\n        var W = this.W_;\r\n        // get 16 big endian words\r\n        if (typeof buf === 'string') {\r\n            for (var i = 0; i < 16; i++) {\r\n                // TODO(user): [bug 8140122] Recent versions of Safari for Mac OS and iOS\r\n                // have a bug that turns the post-increment ++ operator into pre-increment\r\n                // during JIT compilation.  We have code that depends heavily on SHA-1 for\r\n                // correctness and which is affected by this bug, so I've removed all uses\r\n                // of post-increment ++ in which the result value is used.  We can revert\r\n                // this change once the Safari bug\r\n                // (https://bugs.webkit.org/show_bug.cgi?id=109036) has been fixed and\r\n                // most clients have been updated.\r\n                W[i] =\r\n                    (buf.charCodeAt(offset) << 24) |\r\n                        (buf.charCodeAt(offset + 1) << 16) |\r\n                        (buf.charCodeAt(offset + 2) << 8) |\r\n                        buf.charCodeAt(offset + 3);\r\n                offset += 4;\r\n            }\r\n        }\r\n        else {\r\n            for (var i = 0; i < 16; i++) {\r\n                W[i] =\r\n                    (buf[offset] << 24) |\r\n                        (buf[offset + 1] << 16) |\r\n                        (buf[offset + 2] << 8) |\r\n                        buf[offset + 3];\r\n                offset += 4;\r\n            }\r\n        }\r\n        // expand to 80 words\r\n        for (var i = 16; i < 80; i++) {\r\n            var t = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];\r\n            W[i] = ((t << 1) | (t >>> 31)) & 0xffffffff;\r\n        }\r\n        var a = this.chain_[0];\r\n        var b = this.chain_[1];\r\n        var c = this.chain_[2];\r\n        var d = this.chain_[3];\r\n        var e = this.chain_[4];\r\n        var f, k;\r\n        // TODO(user): Try to unroll this loop to speed up the computation.\r\n        for (var i = 0; i < 80; i++) {\r\n            if (i < 40) {\r\n                if (i < 20) {\r\n                    f = d ^ (b & (c ^ d));\r\n                    k = 0x5a827999;\r\n                }\r\n                else {\r\n                    f = b ^ c ^ d;\r\n                    k = 0x6ed9eba1;\r\n                }\r\n            }\r\n            else {\r\n                if (i < 60) {\r\n                    f = (b & c) | (d & (b | c));\r\n                    k = 0x8f1bbcdc;\r\n                }\r\n                else {\r\n                    f = b ^ c ^ d;\r\n                    k = 0xca62c1d6;\r\n                }\r\n            }\r\n            var t = (((a << 5) | (a >>> 27)) + f + e + k + W[i]) & 0xffffffff;\r\n            e = d;\r\n            d = c;\r\n            c = ((b << 30) | (b >>> 2)) & 0xffffffff;\r\n            b = a;\r\n            a = t;\r\n        }\r\n        this.chain_[0] = (this.chain_[0] + a) & 0xffffffff;\r\n        this.chain_[1] = (this.chain_[1] + b) & 0xffffffff;\r\n        this.chain_[2] = (this.chain_[2] + c) & 0xffffffff;\r\n        this.chain_[3] = (this.chain_[3] + d) & 0xffffffff;\r\n        this.chain_[4] = (this.chain_[4] + e) & 0xffffffff;\r\n    };\r\n    Sha1.prototype.update = function (bytes, length) {\r\n        // TODO(johnlenz): tighten the function signature and remove this check\r\n        if (bytes == null) {\r\n            return;\r\n        }\r\n        if (length === undefined) {\r\n            length = bytes.length;\r\n        }\r\n        var lengthMinusBlock = length - this.blockSize;\r\n        var n = 0;\r\n        // Using local instead of member variables gives ~5% speedup on Firefox 16.\r\n        var buf = this.buf_;\r\n        var inbuf = this.inbuf_;\r\n        // The outer while loop should execute at most twice.\r\n        while (n < length) {\r\n            // When we have no data in the block to top up, we can directly process the\r\n            // input buffer (assuming it contains sufficient data). This gives ~25%\r\n            // speedup on Chrome 23 and ~15% speedup on Firefox 16, but requires that\r\n            // the data is provided in large chunks (or in multiples of 64 bytes).\r\n            if (inbuf === 0) {\r\n                while (n <= lengthMinusBlock) {\r\n                    this.compress_(bytes, n);\r\n                    n += this.blockSize;\r\n                }\r\n            }\r\n            if (typeof bytes === 'string') {\r\n                while (n < length) {\r\n                    buf[inbuf] = bytes.charCodeAt(n);\r\n                    ++inbuf;\r\n                    ++n;\r\n                    if (inbuf === this.blockSize) {\r\n                        this.compress_(buf);\r\n                        inbuf = 0;\r\n                        // Jump to the outer loop so we use the full-block optimization.\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                while (n < length) {\r\n                    buf[inbuf] = bytes[n];\r\n                    ++inbuf;\r\n                    ++n;\r\n                    if (inbuf === this.blockSize) {\r\n                        this.compress_(buf);\r\n                        inbuf = 0;\r\n                        // Jump to the outer loop so we use the full-block optimization.\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.inbuf_ = inbuf;\r\n        this.total_ += length;\r\n    };\r\n    /** @override */\r\n    Sha1.prototype.digest = function () {\r\n        var digest = [];\r\n        var totalBits = this.total_ * 8;\r\n        // Add pad 0x80 0x00*.\r\n        if (this.inbuf_ < 56) {\r\n            this.update(this.pad_, 56 - this.inbuf_);\r\n        }\r\n        else {\r\n            this.update(this.pad_, this.blockSize - (this.inbuf_ - 56));\r\n        }\r\n        // Add # bits.\r\n        for (var i = this.blockSize - 1; i >= 56; i--) {\r\n            this.buf_[i] = totalBits & 255;\r\n            totalBits /= 256; // Don't use bit-shifting here!\r\n        }\r\n        this.compress_(this.buf_);\r\n        var n = 0;\r\n        for (var i = 0; i < 5; i++) {\r\n            for (var j = 24; j >= 0; j -= 8) {\r\n                digest[n] = (this.chain_[i] >> j) & 255;\r\n                ++n;\r\n            }\r\n        }\r\n        return digest;\r\n    };\r\n    return Sha1;\r\n}());\n\n/**\r\n * Helper to make a Subscribe function (just like Promise helps make a\r\n * Thenable).\r\n *\r\n * @param executor Function which can make calls to a single Observer\r\n *     as a proxy.\r\n * @param onNoObservers Callback when count of Observers goes to zero.\r\n */\r\nfunction createSubscribe(executor, onNoObservers) {\r\n    var proxy = new ObserverProxy(executor, onNoObservers);\r\n    return proxy.subscribe.bind(proxy);\r\n}\r\n/**\r\n * Implement fan-out for any number of Observers attached via a subscribe\r\n * function.\r\n */\r\nvar ObserverProxy = /** @class */ (function () {\r\n    /**\r\n     * @param executor Function which can make calls to a single Observer\r\n     *     as a proxy.\r\n     * @param onNoObservers Callback when count of Observers goes to zero.\r\n     */\r\n    function ObserverProxy(executor, onNoObservers) {\r\n        var _this = this;\r\n        this.observers = [];\r\n        this.unsubscribes = [];\r\n        this.observerCount = 0;\r\n        // Micro-task scheduling by calling task.then().\r\n        this.task = Promise.resolve();\r\n        this.finalized = false;\r\n        this.onNoObservers = onNoObservers;\r\n        // Call the executor asynchronously so subscribers that are called\r\n        // synchronously after the creation of the subscribe function\r\n        // can still receive the very first value generated in the executor.\r\n        this.task\r\n            .then(function () {\r\n            executor(_this);\r\n        })\r\n            .catch(function (e) {\r\n            _this.error(e);\r\n        });\r\n    }\r\n    ObserverProxy.prototype.next = function (value) {\r\n        this.forEachObserver(function (observer) {\r\n            observer.next(value);\r\n        });\r\n    };\r\n    ObserverProxy.prototype.error = function (error) {\r\n        this.forEachObserver(function (observer) {\r\n            observer.error(error);\r\n        });\r\n        this.close(error);\r\n    };\r\n    ObserverProxy.prototype.complete = function () {\r\n        this.forEachObserver(function (observer) {\r\n            observer.complete();\r\n        });\r\n        this.close();\r\n    };\r\n    /**\r\n     * Subscribe function that can be used to add an Observer to the fan-out list.\r\n     *\r\n     * - We require that no event is sent to a subscriber sychronously to their\r\n     *   call to subscribe().\r\n     */\r\n    ObserverProxy.prototype.subscribe = function (nextOrObserver, error, complete) {\r\n        var _this = this;\r\n        var observer;\r\n        if (nextOrObserver === undefined &&\r\n            error === undefined &&\r\n            complete === undefined) {\r\n            throw new Error('Missing Observer.');\r\n        }\r\n        // Assemble an Observer object when passed as callback functions.\r\n        if (implementsAnyMethods(nextOrObserver, [\r\n            'next',\r\n            'error',\r\n            'complete'\r\n        ])) {\r\n            observer = nextOrObserver;\r\n        }\r\n        else {\r\n            observer = {\r\n                next: nextOrObserver,\r\n                error: error,\r\n                complete: complete\r\n            };\r\n        }\r\n        if (observer.next === undefined) {\r\n            observer.next = noop;\r\n        }\r\n        if (observer.error === undefined) {\r\n            observer.error = noop;\r\n        }\r\n        if (observer.complete === undefined) {\r\n            observer.complete = noop;\r\n        }\r\n        var unsub = this.unsubscribeOne.bind(this, this.observers.length);\r\n        // Attempt to subscribe to a terminated Observable - we\r\n        // just respond to the Observer with the final error or complete\r\n        // event.\r\n        if (this.finalized) {\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            this.task.then(function () {\r\n                try {\r\n                    if (_this.finalError) {\r\n                        observer.error(_this.finalError);\r\n                    }\r\n                    else {\r\n                        observer.complete();\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    // nothing\r\n                }\r\n                return;\r\n            });\r\n        }\r\n        this.observers.push(observer);\r\n        return unsub;\r\n    };\r\n    // Unsubscribe is synchronous - we guarantee that no events are sent to\r\n    // any unsubscribed Observer.\r\n    ObserverProxy.prototype.unsubscribeOne = function (i) {\r\n        if (this.observers === undefined || this.observers[i] === undefined) {\r\n            return;\r\n        }\r\n        delete this.observers[i];\r\n        this.observerCount -= 1;\r\n        if (this.observerCount === 0 && this.onNoObservers !== undefined) {\r\n            this.onNoObservers(this);\r\n        }\r\n    };\r\n    ObserverProxy.prototype.forEachObserver = function (fn) {\r\n        if (this.finalized) {\r\n            // Already closed by previous event....just eat the additional values.\r\n            return;\r\n        }\r\n        // Since sendOne calls asynchronously - there is no chance that\r\n        // this.observers will become undefined.\r\n        for (var i = 0; i < this.observers.length; i++) {\r\n            this.sendOne(i, fn);\r\n        }\r\n    };\r\n    // Call the Observer via one of it's callback function. We are careful to\r\n    // confirm that the observe has not been unsubscribed since this asynchronous\r\n    // function had been queued.\r\n    ObserverProxy.prototype.sendOne = function (i, fn) {\r\n        var _this = this;\r\n        // Execute the callback asynchronously\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this.task.then(function () {\r\n            if (_this.observers !== undefined && _this.observers[i] !== undefined) {\r\n                try {\r\n                    fn(_this.observers[i]);\r\n                }\r\n                catch (e) {\r\n                    // Ignore exceptions raised in Observers or missing methods of an\r\n                    // Observer.\r\n                    // Log error to console. b/31404806\r\n                    if (typeof console !== 'undefined' && console.error) {\r\n                        console.error(e);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    };\r\n    ObserverProxy.prototype.close = function (err) {\r\n        var _this = this;\r\n        if (this.finalized) {\r\n            return;\r\n        }\r\n        this.finalized = true;\r\n        if (err !== undefined) {\r\n            this.finalError = err;\r\n        }\r\n        // Proxy is no longer needed - garbage collect references\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this.task.then(function () {\r\n            _this.observers = undefined;\r\n            _this.onNoObservers = undefined;\r\n        });\r\n    };\r\n    return ObserverProxy;\r\n}());\r\n/** Turn synchronous function into one called asynchronously. */\r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\nfunction async(fn, onError) {\r\n    return function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        Promise.resolve(true)\r\n            .then(function () {\r\n            fn.apply(void 0, args);\r\n        })\r\n            .catch(function (error) {\r\n            if (onError) {\r\n                onError(error);\r\n            }\r\n        });\r\n    };\r\n}\r\n/**\r\n * Return true if the object passed in implements any of the named methods.\r\n */\r\nfunction implementsAnyMethods(obj, methods) {\r\n    if (typeof obj !== 'object' || obj === null) {\r\n        return false;\r\n    }\r\n    for (var _i = 0, methods_1 = methods; _i < methods_1.length; _i++) {\r\n        var method = methods_1[_i];\r\n        if (method in obj && typeof obj[method] === 'function') {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction noop() {\r\n    // do nothing\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Check to make sure the appropriate number of arguments are provided for a public function.\r\n * Throws an error if it fails.\r\n *\r\n * @param fnName The function name\r\n * @param minCount The minimum number of arguments to allow for the function call\r\n * @param maxCount The maximum number of argument to allow for the function call\r\n * @param argCount The actual number of arguments provided.\r\n */\r\nvar validateArgCount = function (fnName, minCount, maxCount, argCount) {\r\n    var argError;\r\n    if (argCount < minCount) {\r\n        argError = 'at least ' + minCount;\r\n    }\r\n    else if (argCount > maxCount) {\r\n        argError = maxCount === 0 ? 'none' : 'no more than ' + maxCount;\r\n    }\r\n    if (argError) {\r\n        var error = fnName +\r\n            ' failed: Was called with ' +\r\n            argCount +\r\n            (argCount === 1 ? ' argument.' : ' arguments.') +\r\n            ' Expects ' +\r\n            argError +\r\n            '.';\r\n        throw new Error(error);\r\n    }\r\n};\r\n/**\r\n * Generates a string to prefix an error message about failed argument validation\r\n *\r\n * @param fnName The function name\r\n * @param argumentNumber The index of the argument\r\n * @param optional Whether or not the argument is optional\r\n * @return The prefix to add to the error thrown for validation.\r\n */\r\nfunction errorPrefix(fnName, argumentNumber, optional) {\r\n    var argName = '';\r\n    switch (argumentNumber) {\r\n        case 1:\r\n            argName = optional ? 'first' : 'First';\r\n            break;\r\n        case 2:\r\n            argName = optional ? 'second' : 'Second';\r\n            break;\r\n        case 3:\r\n            argName = optional ? 'third' : 'Third';\r\n            break;\r\n        case 4:\r\n            argName = optional ? 'fourth' : 'Fourth';\r\n            break;\r\n        default:\r\n            throw new Error('errorPrefix called with argumentNumber > 4.  Need to update it?');\r\n    }\r\n    var error = fnName + ' failed: ';\r\n    error += argName + ' argument ';\r\n    return error;\r\n}\r\n/**\r\n * @param fnName\r\n * @param argumentNumber\r\n * @param namespace\r\n * @param optional\r\n */\r\nfunction validateNamespace(fnName, argumentNumber, namespace, optional) {\r\n    if (optional && !namespace) {\r\n        return;\r\n    }\r\n    if (typeof namespace !== 'string') {\r\n        //TODO: I should do more validation here. We only allow certain chars in namespaces.\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'must be a valid firebase namespace.');\r\n    }\r\n}\r\nfunction validateCallback(fnName, argumentNumber, \r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\ncallback, optional) {\r\n    if (optional && !callback) {\r\n        return;\r\n    }\r\n    if (typeof callback !== 'function') {\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'must be a valid function.');\r\n    }\r\n}\r\nfunction validateContextObject(fnName, argumentNumber, context, optional) {\r\n    if (optional && !context) {\r\n        return;\r\n    }\r\n    if (typeof context !== 'object' || context === null) {\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'must be a valid context object.');\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Code originally came from goog.crypt.stringToUtf8ByteArray, but for some reason they\r\n// automatically replaced '\\r\\n' with '\\n', and they didn't handle surrogate pairs,\r\n// so it's been modified.\r\n// Note that not all Unicode characters appear as single characters in JavaScript strings.\r\n// fromCharCode returns the UTF-16 encoding of a character - so some Unicode characters\r\n// use 2 characters in Javascript.  All 4-byte UTF-8 characters begin with a first\r\n// character in the range 0xD800 - 0xDBFF (the first character of a so-called surrogate\r\n// pair).\r\n// See http://www.ecma-international.org/ecma-262/5.1/#sec-15.1.3\r\n/**\r\n * @param {string} str\r\n * @return {Array}\r\n */\r\nvar stringToByteArray$1 = function (str) {\r\n    var out = [];\r\n    var p = 0;\r\n    for (var i = 0; i < str.length; i++) {\r\n        var c = str.charCodeAt(i);\r\n        // Is this the lead surrogate in a surrogate pair?\r\n        if (c >= 0xd800 && c <= 0xdbff) {\r\n            var high = c - 0xd800; // the high 10 bits.\r\n            i++;\r\n            assert(i < str.length, 'Surrogate pair missing trail surrogate.');\r\n            var low = str.charCodeAt(i) - 0xdc00; // the low 10 bits.\r\n            c = 0x10000 + (high << 10) + low;\r\n        }\r\n        if (c < 128) {\r\n            out[p++] = c;\r\n        }\r\n        else if (c < 2048) {\r\n            out[p++] = (c >> 6) | 192;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else if (c < 65536) {\r\n            out[p++] = (c >> 12) | 224;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else {\r\n            out[p++] = (c >> 18) | 240;\r\n            out[p++] = ((c >> 12) & 63) | 128;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n    }\r\n    return out;\r\n};\r\n/**\r\n * Calculate length without actually converting; useful for doing cheaper validation.\r\n * @param {string} str\r\n * @return {number}\r\n */\r\nvar stringLength = function (str) {\r\n    var p = 0;\r\n    for (var i = 0; i < str.length; i++) {\r\n        var c = str.charCodeAt(i);\r\n        if (c < 128) {\r\n            p++;\r\n        }\r\n        else if (c < 2048) {\r\n            p += 2;\r\n        }\r\n        else if (c >= 0xd800 && c <= 0xdbff) {\r\n            // Lead surrogate of a surrogate pair.  The pair together will take 4 bytes to represent.\r\n            p += 4;\r\n            i++; // skip trail surrogate.\r\n        }\r\n        else {\r\n            p += 3;\r\n        }\r\n    }\r\n    return p;\r\n};\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * The amount of milliseconds to exponentially increase.\r\n */\r\nvar DEFAULT_INTERVAL_MILLIS = 1000;\r\n/**\r\n * The factor to backoff by.\r\n * Should be a number greater than 1.\r\n */\r\nvar DEFAULT_BACKOFF_FACTOR = 2;\r\n/**\r\n * The maximum milliseconds to increase to.\r\n *\r\n * <p>Visible for testing\r\n */\r\nvar MAX_VALUE_MILLIS = 4 * 60 * 60 * 1000; // Four hours, like iOS and Android.\r\n/**\r\n * The percentage of backoff time to randomize by.\r\n * See\r\n * http://go/safe-client-behavior#step-1-determine-the-appropriate-retry-interval-to-handle-spike-traffic\r\n * for context.\r\n *\r\n * <p>Visible for testing\r\n */\r\nvar RANDOM_FACTOR = 0.5;\r\n/**\r\n * Based on the backoff method from\r\n * https://github.com/google/closure-library/blob/master/closure/goog/math/exponentialbackoff.js.\r\n * Extracted here so we don't need to pass metadata and a stateful ExponentialBackoff object around.\r\n */\r\nfunction calculateBackoffMillis(backoffCount, intervalMillis, backoffFactor) {\r\n    if (intervalMillis === void 0) { intervalMillis = DEFAULT_INTERVAL_MILLIS; }\r\n    if (backoffFactor === void 0) { backoffFactor = DEFAULT_BACKOFF_FACTOR; }\r\n    // Calculates an exponentially increasing value.\r\n    // Deviation: calculates value from count and a constant interval, so we only need to save value\r\n    // and count to restore state.\r\n    var currBaseValue = intervalMillis * Math.pow(backoffFactor, backoffCount);\r\n    // A random \"fuzz\" to avoid waves of retries.\r\n    // Deviation: randomFactor is required.\r\n    var randomWait = Math.round(\r\n    // A fraction of the backoff value to add/subtract.\r\n    // Deviation: changes multiplication order to improve readability.\r\n    RANDOM_FACTOR *\r\n        currBaseValue *\r\n        // A random float (rounded to int by Math.round above) in the range [-1, 1]. Determines\r\n        // if we add or subtract.\r\n        (Math.random() - 0.5) *\r\n        2);\r\n    // Limits backoff to max to avoid effectively permanent backoff.\r\n    return Math.min(MAX_VALUE_MILLIS, currBaseValue + randomWait);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Provide English ordinal letters after a number\r\n */\r\nfunction ordinal(i) {\r\n    if (!Number.isFinite(i)) {\r\n        return \"\" + i;\r\n    }\r\n    return i + indicator(i);\r\n}\r\nfunction indicator(i) {\r\n    i = Math.abs(i);\r\n    var cent = i % 100;\r\n    if (cent >= 10 && cent <= 20) {\r\n        return 'th';\r\n    }\r\n    var dec = i % 10;\r\n    if (dec === 1) {\r\n        return 'st';\r\n    }\r\n    if (dec === 2) {\r\n        return 'nd';\r\n    }\r\n    if (dec === 3) {\r\n        return 'rd';\r\n    }\r\n    return 'th';\r\n}\n\nexport { CONSTANTS, Deferred, ErrorFactory, FirebaseError, MAX_VALUE_MILLIS, RANDOM_FACTOR, Sha1, areCookiesEnabled, assert, assertionError, async, base64, base64Decode, base64Encode, calculateBackoffMillis, contains, createSubscribe, decode, deepCopy, deepExtend, errorPrefix, getUA, isAdmin, isBrowser, isBrowserExtension, isElectron, isEmpty, isIE, isIndexedDBAvailable, isMobileCordova, isNode, isNodeSdk, isReactNative, isSafari, isUWP, isValidFormat, isValidTimestamp, issuedAtTime, jsonEval, map, ordinal, querystring, querystringDecode, safeGet, stringLength, stringToByteArray$1 as stringToByteArray, stringify, validateArgCount, validateCallback, validateContextObject, validateIndexedDBOpenable, validateNamespace };\n//# sourceMappingURL=index.esm.js.map\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nfunction __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\n/**\r\n * A container for all of the Logger instances\r\n */\r\nvar instances = [];\r\n/**\r\n * The JS SDK supports 5 log levels and also allows a user the ability to\r\n * silence the logs altogether.\r\n *\r\n * The order is a follows:\r\n * DEBUG < VERBOSE < INFO < WARN < ERROR\r\n *\r\n * All of the log types above the current log level will be captured (i.e. if\r\n * you set the log level to `INFO`, errors will still be logged, but `DEBUG` and\r\n * `VERBOSE` logs will not)\r\n */\r\nvar LogLevel;\r\n(function (LogLevel) {\r\n    LogLevel[LogLevel[\"DEBUG\"] = 0] = \"DEBUG\";\r\n    LogLevel[LogLevel[\"VERBOSE\"] = 1] = \"VERBOSE\";\r\n    LogLevel[LogLevel[\"INFO\"] = 2] = \"INFO\";\r\n    LogLevel[LogLevel[\"WARN\"] = 3] = \"WARN\";\r\n    LogLevel[LogLevel[\"ERROR\"] = 4] = \"ERROR\";\r\n    LogLevel[LogLevel[\"SILENT\"] = 5] = \"SILENT\";\r\n})(LogLevel || (LogLevel = {}));\r\nvar levelStringToEnum = {\r\n    'debug': LogLevel.DEBUG,\r\n    'verbose': LogLevel.VERBOSE,\r\n    'info': LogLevel.INFO,\r\n    'warn': LogLevel.WARN,\r\n    'error': LogLevel.ERROR,\r\n    'silent': LogLevel.SILENT\r\n};\r\n/**\r\n * The default log level\r\n */\r\nvar defaultLogLevel = LogLevel.INFO;\r\n/**\r\n * By default, `console.debug` is not displayed in the developer console (in\r\n * chrome). To avoid forcing users to have to opt-in to these logs twice\r\n * (i.e. once for firebase, and once in the console), we are sending `DEBUG`\r\n * logs to the `console.log` function.\r\n */\r\nvar ConsoleMethod = (_a = {},\r\n    _a[LogLevel.DEBUG] = 'log',\r\n    _a[LogLevel.VERBOSE] = 'log',\r\n    _a[LogLevel.INFO] = 'info',\r\n    _a[LogLevel.WARN] = 'warn',\r\n    _a[LogLevel.ERROR] = 'error',\r\n    _a);\r\n/**\r\n * The default log handler will forward DEBUG, VERBOSE, INFO, WARN, and ERROR\r\n * messages on to their corresponding console counterparts (if the log method\r\n * is supported by the current log level)\r\n */\r\nvar defaultLogHandler = function (instance, logType) {\r\n    var args = [];\r\n    for (var _i = 2; _i < arguments.length; _i++) {\r\n        args[_i - 2] = arguments[_i];\r\n    }\r\n    if (logType < instance.logLevel) {\r\n        return;\r\n    }\r\n    var now = new Date().toISOString();\r\n    var method = ConsoleMethod[logType];\r\n    if (method) {\r\n        console[method].apply(console, __spreadArrays([\"[\" + now + \"]  \" + instance.name + \":\"], args));\r\n    }\r\n    else {\r\n        throw new Error(\"Attempted to log a message with an invalid logType (value: \" + logType + \")\");\r\n    }\r\n};\r\nvar Logger = /** @class */ (function () {\r\n    /**\r\n     * Gives you an instance of a Logger to capture messages according to\r\n     * Firebase's logging scheme.\r\n     *\r\n     * @param name The name that the logs will be associated with\r\n     */\r\n    function Logger(name) {\r\n        this.name = name;\r\n        /**\r\n         * The log level of the given Logger instance.\r\n         */\r\n        this._logLevel = defaultLogLevel;\r\n        /**\r\n         * The main (internal) log handler for the Logger instance.\r\n         * Can be set to a new function in internal package code but not by user.\r\n         */\r\n        this._logHandler = defaultLogHandler;\r\n        /**\r\n         * The optional, additional, user-defined log handler for the Logger instance.\r\n         */\r\n        this._userLogHandler = null;\r\n        /**\r\n         * Capture the current instance for later use\r\n         */\r\n        instances.push(this);\r\n    }\r\n    Object.defineProperty(Logger.prototype, \"logLevel\", {\r\n        get: function () {\r\n            return this._logLevel;\r\n        },\r\n        set: function (val) {\r\n            if (!(val in LogLevel)) {\r\n                throw new TypeError(\"Invalid value \\\"\" + val + \"\\\" assigned to `logLevel`\");\r\n            }\r\n            this._logLevel = val;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    // Workaround for setter/getter having to be the same type.\r\n    Logger.prototype.setLogLevel = function (val) {\r\n        this._logLevel = typeof val === 'string' ? levelStringToEnum[val] : val;\r\n    };\r\n    Object.defineProperty(Logger.prototype, \"logHandler\", {\r\n        get: function () {\r\n            return this._logHandler;\r\n        },\r\n        set: function (val) {\r\n            if (typeof val !== 'function') {\r\n                throw new TypeError('Value assigned to `logHandler` must be a function');\r\n            }\r\n            this._logHandler = val;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Logger.prototype, \"userLogHandler\", {\r\n        get: function () {\r\n            return this._userLogHandler;\r\n        },\r\n        set: function (val) {\r\n            this._userLogHandler = val;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * The functions below are all based on the `console` interface\r\n     */\r\n    Logger.prototype.debug = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.DEBUG], args));\r\n        this._logHandler.apply(this, __spreadArrays([this, LogLevel.DEBUG], args));\r\n    };\r\n    Logger.prototype.log = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.VERBOSE], args));\r\n        this._logHandler.apply(this, __spreadArrays([this, LogLevel.VERBOSE], args));\r\n    };\r\n    Logger.prototype.info = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.INFO], args));\r\n        this._logHandler.apply(this, __spreadArrays([this, LogLevel.INFO], args));\r\n    };\r\n    Logger.prototype.warn = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.WARN], args));\r\n        this._logHandler.apply(this, __spreadArrays([this, LogLevel.WARN], args));\r\n    };\r\n    Logger.prototype.error = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.ERROR], args));\r\n        this._logHandler.apply(this, __spreadArrays([this, LogLevel.ERROR], args));\r\n    };\r\n    return Logger;\r\n}());\r\nfunction setLogLevel(level) {\r\n    instances.forEach(function (inst) {\r\n        inst.setLogLevel(level);\r\n    });\r\n}\r\nfunction setUserLogHandler(logCallback, options) {\r\n    var _loop_1 = function (instance) {\r\n        var customLogLevel = null;\r\n        if (options && options.level) {\r\n            customLogLevel = levelStringToEnum[options.level];\r\n        }\r\n        if (logCallback === null) {\r\n            instance.userLogHandler = null;\r\n        }\r\n        else {\r\n            instance.userLogHandler = function (instance, level) {\r\n                var args = [];\r\n                for (var _i = 2; _i < arguments.length; _i++) {\r\n                    args[_i - 2] = arguments[_i];\r\n                }\r\n                var message = args\r\n                    .map(function (arg) {\r\n                    if (arg == null) {\r\n                        return null;\r\n                    }\r\n                    else if (typeof arg === 'string') {\r\n                        return arg;\r\n                    }\r\n                    else if (typeof arg === 'number' || typeof arg === 'boolean') {\r\n                        return arg.toString();\r\n                    }\r\n                    else if (arg instanceof Error) {\r\n                        return arg.message;\r\n                    }\r\n                    else {\r\n                        try {\r\n                            return JSON.stringify(arg);\r\n                        }\r\n                        catch (ignored) {\r\n                            return null;\r\n                        }\r\n                    }\r\n                })\r\n                    .filter(function (arg) { return arg; })\r\n                    .join(' ');\r\n                if (level >= (customLogLevel !== null && customLogLevel !== void 0 ? customLogLevel : instance.logLevel)) {\r\n                    logCallback({\r\n                        level: LogLevel[level].toLowerCase(),\r\n                        message: message,\r\n                        args: args,\r\n                        type: instance.name\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    };\r\n    for (var _i = 0, instances_1 = instances; _i < instances_1.length; _i++) {\r\n        var instance = instances_1[_i];\r\n        _loop_1(instance);\r\n    }\r\n}\n\nexport { LogLevel, Logger, setLogLevel, setUserLogHandler };\n//# sourceMappingURL=index.esm.js.map\n","import { __assign, __values, __read, __awaiter, __generator, __spread } from 'tslib';\nimport { Deferred } from '@firebase/util';\n\n/**\r\n * Component for service name T, e.g. `auth`, `auth-internal`\r\n */\r\nvar Component = /** @class */ (function () {\r\n    /**\r\n     *\r\n     * @param name The public service name, e.g. app, auth, firestore, database\r\n     * @param instanceFactory Service factory responsible for creating the public interface\r\n     * @param type whether the service provided by the component is public or private\r\n     */\r\n    function Component(name, instanceFactory, type) {\r\n        this.name = name;\r\n        this.instanceFactory = instanceFactory;\r\n        this.type = type;\r\n        this.multipleInstances = false;\r\n        /**\r\n         * Properties to be added to the service namespace\r\n         */\r\n        this.serviceProps = {};\r\n        this.instantiationMode = \"LAZY\" /* LAZY */;\r\n    }\r\n    Component.prototype.setInstantiationMode = function (mode) {\r\n        this.instantiationMode = mode;\r\n        return this;\r\n    };\r\n    Component.prototype.setMultipleInstances = function (multipleInstances) {\r\n        this.multipleInstances = multipleInstances;\r\n        return this;\r\n    };\r\n    Component.prototype.setServiceProps = function (props) {\r\n        this.serviceProps = props;\r\n        return this;\r\n    };\r\n    return Component;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DEFAULT_ENTRY_NAME = '[DEFAULT]';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Provider for instance for service name T, e.g. 'auth', 'auth-internal'\r\n * NameServiceMapping[T] is an alias for the type of the instance\r\n */\r\nvar Provider = /** @class */ (function () {\r\n    function Provider(name, container) {\r\n        this.name = name;\r\n        this.container = container;\r\n        this.component = null;\r\n        this.instances = new Map();\r\n        this.instancesDeferred = new Map();\r\n    }\r\n    /**\r\n     * @param identifier A provider can provide mulitple instances of a service\r\n     * if this.component.multipleInstances is true.\r\n     */\r\n    Provider.prototype.get = function (identifier) {\r\n        if (identifier === void 0) { identifier = DEFAULT_ENTRY_NAME; }\r\n        // if multipleInstances is not supported, use the default name\r\n        var normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\r\n        if (!this.instancesDeferred.has(normalizedIdentifier)) {\r\n            var deferred = new Deferred();\r\n            this.instancesDeferred.set(normalizedIdentifier, deferred);\r\n            // If the service instance is available, resolve the promise with it immediately\r\n            try {\r\n                var instance = this.getOrInitializeService(normalizedIdentifier);\r\n                if (instance) {\r\n                    deferred.resolve(instance);\r\n                }\r\n            }\r\n            catch (e) {\r\n                // when the instance factory throws an exception during get(), it should not cause\r\n                // a fatal error. We just return the unresolved promise in this case.\r\n            }\r\n        }\r\n        return this.instancesDeferred.get(normalizedIdentifier).promise;\r\n    };\r\n    Provider.prototype.getImmediate = function (options) {\r\n        var _a = __assign({ identifier: DEFAULT_ENTRY_NAME, optional: false }, options), identifier = _a.identifier, optional = _a.optional;\r\n        // if multipleInstances is not supported, use the default name\r\n        var normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\r\n        try {\r\n            var instance = this.getOrInitializeService(normalizedIdentifier);\r\n            if (!instance) {\r\n                if (optional) {\r\n                    return null;\r\n                }\r\n                throw Error(\"Service \" + this.name + \" is not available\");\r\n            }\r\n            return instance;\r\n        }\r\n        catch (e) {\r\n            if (optional) {\r\n                return null;\r\n            }\r\n            else {\r\n                throw e;\r\n            }\r\n        }\r\n    };\r\n    Provider.prototype.getComponent = function () {\r\n        return this.component;\r\n    };\r\n    Provider.prototype.setComponent = function (component) {\r\n        var e_1, _a;\r\n        if (component.name !== this.name) {\r\n            throw Error(\"Mismatching Component \" + component.name + \" for Provider \" + this.name + \".\");\r\n        }\r\n        if (this.component) {\r\n            throw Error(\"Component for \" + this.name + \" has already been provided\");\r\n        }\r\n        this.component = component;\r\n        // if the service is eager, initialize the default instance\r\n        if (isComponentEager(component)) {\r\n            try {\r\n                this.getOrInitializeService(DEFAULT_ENTRY_NAME);\r\n            }\r\n            catch (e) {\r\n                // when the instance factory for an eager Component throws an exception during the eager\r\n                // initialization, it should not cause a fatal error.\r\n                // TODO: Investigate if we need to make it configurable, because some component may want to cause\r\n                // a fatal error in this case?\r\n            }\r\n        }\r\n        try {\r\n            // Create service instances for the pending promises and resolve them\r\n            // NOTE: if this.multipleInstances is false, only the default instance will be created\r\n            // and all promises with resolve with it regardless of the identifier.\r\n            for (var _b = __values(this.instancesDeferred.entries()), _c = _b.next(); !_c.done; _c = _b.next()) {\r\n                var _d = __read(_c.value, 2), instanceIdentifier = _d[0], instanceDeferred = _d[1];\r\n                var normalizedIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);\r\n                try {\r\n                    // `getOrInitializeService()` should always return a valid instance since a component is guaranteed. use ! to make typescript happy.\r\n                    var instance = this.getOrInitializeService(normalizedIdentifier);\r\n                    instanceDeferred.resolve(instance);\r\n                }\r\n                catch (e) {\r\n                    // when the instance factory throws an exception, it should not cause\r\n                    // a fatal error. We just leave the promise unresolved.\r\n                }\r\n            }\r\n        }\r\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n        finally {\r\n            try {\r\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\r\n            }\r\n            finally { if (e_1) throw e_1.error; }\r\n        }\r\n    };\r\n    Provider.prototype.clearInstance = function (identifier) {\r\n        if (identifier === void 0) { identifier = DEFAULT_ENTRY_NAME; }\r\n        this.instancesDeferred.delete(identifier);\r\n        this.instances.delete(identifier);\r\n    };\r\n    // app.delete() will call this method on every provider to delete the services\r\n    // TODO: should we mark the provider as deleted?\r\n    Provider.prototype.delete = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var services;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        services = Array.from(this.instances.values());\r\n                        return [4 /*yield*/, Promise.all(__spread(services\r\n                                .filter(function (service) { return 'INTERNAL' in service; }) // legacy services\r\n                                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                                .map(function (service) { return service.INTERNAL.delete(); }), services\r\n                                .filter(function (service) { return '_delete' in service; }) // modularized services\r\n                                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                                .map(function (service) { return service._delete(); })))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Provider.prototype.isComponentSet = function () {\r\n        return this.component != null;\r\n    };\r\n    Provider.prototype.getOrInitializeService = function (identifier) {\r\n        var instance = this.instances.get(identifier);\r\n        if (!instance && this.component) {\r\n            instance = this.component.instanceFactory(this.container, normalizeIdentifierForFactory(identifier));\r\n            this.instances.set(identifier, instance);\r\n        }\r\n        return instance || null;\r\n    };\r\n    Provider.prototype.normalizeInstanceIdentifier = function (identifier) {\r\n        if (this.component) {\r\n            return this.component.multipleInstances ? identifier : DEFAULT_ENTRY_NAME;\r\n        }\r\n        else {\r\n            return identifier; // assume multiple instances are supported before the component is provided.\r\n        }\r\n    };\r\n    return Provider;\r\n}());\r\n// undefined should be passed to the service factory for the default instance\r\nfunction normalizeIdentifierForFactory(identifier) {\r\n    return identifier === DEFAULT_ENTRY_NAME ? undefined : identifier;\r\n}\r\nfunction isComponentEager(component) {\r\n    return component.instantiationMode === \"EAGER\" /* EAGER */;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * ComponentContainer that provides Providers for service name T, e.g. `auth`, `auth-internal`\r\n */\r\nvar ComponentContainer = /** @class */ (function () {\r\n    function ComponentContainer(name) {\r\n        this.name = name;\r\n        this.providers = new Map();\r\n    }\r\n    /**\r\n     *\r\n     * @param component Component being added\r\n     * @param overwrite When a component with the same name has already been registered,\r\n     * if overwrite is true: overwrite the existing component with the new component and create a new\r\n     * provider with the new component. It can be useful in tests where you want to use different mocks\r\n     * for different tests.\r\n     * if overwrite is false: throw an exception\r\n     */\r\n    ComponentContainer.prototype.addComponent = function (component) {\r\n        var provider = this.getProvider(component.name);\r\n        if (provider.isComponentSet()) {\r\n            throw new Error(\"Component \" + component.name + \" has already been registered with \" + this.name);\r\n        }\r\n        provider.setComponent(component);\r\n    };\r\n    ComponentContainer.prototype.addOrOverwriteComponent = function (component) {\r\n        var provider = this.getProvider(component.name);\r\n        if (provider.isComponentSet()) {\r\n            // delete the existing provider from the container, so we can register the new component\r\n            this.providers.delete(component.name);\r\n        }\r\n        this.addComponent(component);\r\n    };\r\n    /**\r\n     * getProvider provides a type safe interface where it can only be called with a field name\r\n     * present in NameServiceMapping interface.\r\n     *\r\n     * Firebase SDKs providing services should extend NameServiceMapping interface to register\r\n     * themselves.\r\n     */\r\n    ComponentContainer.prototype.getProvider = function (name) {\r\n        if (this.providers.has(name)) {\r\n            return this.providers.get(name);\r\n        }\r\n        // create a Provider for a service that hasn't registered with Firebase\r\n        var provider = new Provider(name, this);\r\n        this.providers.set(name, provider);\r\n        return provider;\r\n    };\r\n    ComponentContainer.prototype.getProviders = function () {\r\n        return Array.from(this.providers.values());\r\n    };\r\n    return ComponentContainer;\r\n}());\n\nexport { Component, ComponentContainer, Provider };\n//# sourceMappingURL=index.esm.js.map\n"],"sourceRoot":""}